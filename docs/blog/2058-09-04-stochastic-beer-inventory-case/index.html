<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-09-09">

<title>Stochastic Inventory Modelling: A Tutorial for Dummies using R – Isaac Forzán</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-37a1b0be932221daf612efc1499196ad.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Stochastic Inventory Modelling: A Tutorial for Dummies using R – Isaac Forzán">
<meta property="og:description" content="">
<meta property="og:image" content="index_files/figure-html/fig-plot1-1.png">
<meta property="og:site_name" content="Isaac Forzán">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Isaac Forzán</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv.pdf"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#beer-business" id="toc-beer-business" class="nav-link" data-scroll-target="#beer-business">Beer business</a>
  <ul class="collapse">
  <li><a href="#inventory-policy-periodic-review-order-up-to-level-r-s" id="toc-inventory-policy-periodic-review-order-up-to-level-r-s" class="nav-link" data-scroll-target="#inventory-policy-periodic-review-order-up-to-level-r-s">Inventory policy: Periodic Review &amp; Order Up-to Level (R, S)</a>
  <ul class="collapse">
  <li><a href="#simulation-time-r-s-policy-in-r" id="toc-simulation-time-r-s-policy-in-r" class="nav-link" data-scroll-target="#simulation-time-r-s-policy-in-r">Simulation time: (R, S) policy in R</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#supply-chains-inventories" id="toc-supply-chains-inventories" class="nav-link" data-scroll-target="#supply-chains-inventories">Supply chains &amp; Inventories</a>
  <ul class="collapse">
  <li><a href="#economic-order-quantity-eoq-model" id="toc-economic-order-quantity-eoq-model" class="nav-link" data-scroll-target="#economic-order-quantity-eoq-model">Economic Order Quantity (EOQ) model</a>
  <ul class="collapse">
  <li><a href="#what-does-it-all-mean" id="toc-what-does-it-all-mean" class="nav-link" data-scroll-target="#what-does-it-all-mean">What does it all mean?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#stochastic-modelling-or-a-number-isnt-just-a-number" id="toc-stochastic-modelling-or-a-number-isnt-just-a-number" class="nav-link" data-scroll-target="#stochastic-modelling-or-a-number-isnt-just-a-number">Stochastic modelling or <em>A number isn’t just a number</em></a>
  <ul class="collapse">
  <li><a href="#the-normal-distribution-plus-words-of-caution" id="toc-the-normal-distribution-plus-words-of-caution" class="nav-link" data-scroll-target="#the-normal-distribution-plus-words-of-caution">The normal distribution plus words of caution</a>
  <ul class="collapse">
  <li><a href="#hyperparameters" id="toc-hyperparameters" class="nav-link" data-scroll-target="#hyperparameters">Hyperparameters</a></li>
  <li><a href="#pdf-cdf" id="toc-pdf-cdf" class="nav-link" data-scroll-target="#pdf-cdf">PDF &amp; CDF</a></li>
  <li><a href="#quantiles-normal-rule-of-thumb" id="toc-quantiles-normal-rule-of-thumb" class="nav-link" data-scroll-target="#quantiles-normal-rule-of-thumb">Quantiles &amp; normal rule of thumb</a></li>
  </ul></li>
  <li><a href="#stochastic-eoq-model" id="toc-stochastic-eoq-model" class="nav-link" data-scroll-target="#stochastic-eoq-model">Stochastic EOQ model</a>
  <ul class="collapse">
  <li><a href="#service-level-alpha-safety-stocks" id="toc-service-level-alpha-safety-stocks" class="nav-link" data-scroll-target="#service-level-alpha-safety-stocks">Service Level (<span class="math inline">\(\alpha\)</span>) &amp; Safety Stocks</a></li>
  <li><a href="#integrating-the-s-r-policy" id="toc-integrating-the-s-r-policy" class="nav-link" data-scroll-target="#integrating-the-s-r-policy">Integrating the (S, R) policy</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#dr.house-brewery-s-r-stochastic-policy-simulation" id="toc-dr.house-brewery-s-r-stochastic-policy-simulation" class="nav-link" data-scroll-target="#dr.house-brewery-s-r-stochastic-policy-simulation">Dr.House brewery (S, R) stochastic policy simulation</a>
  <ul class="collapse">
  <li><a href="#setting-up-the-variables" id="toc-setting-up-the-variables" class="nav-link" data-scroll-target="#setting-up-the-variables">1) Setting up the variables</a></li>
  <li><a href="#estimating-s-and-r" id="toc-estimating-s-and-r" class="nav-link" data-scroll-target="#estimating-s-and-r">2) Estimating S and R</a></li>
  <li><a href="#initialize-vectors" id="toc-initialize-vectors" class="nav-link" data-scroll-target="#initialize-vectors">3) Initialize vectors</a>
  <ul class="collapse">
  <li><a href="#a-word-about-in-transiton-order-inventory" id="toc-a-word-about-in-transiton-order-inventory" class="nav-link" data-scroll-target="#a-word-about-in-transiton-order-inventory">A word about in-transit/on-order inventory</a></li>
  </ul></li>
  <li><a href="#for-loop-simulation" id="toc-for-loop-simulation" class="nav-link" data-scroll-target="#for-loop-simulation">4) For-loop simulation</a>
  <ul class="collapse">
  <li><a href="#learning-by-playing" id="toc-learning-by-playing" class="nav-link" data-scroll-target="#learning-by-playing">Learning by playing</a></li>
  </ul></li>
  <li><a href="#sad-reality" id="toc-sad-reality" class="nav-link" data-scroll-target="#sad-reality">Sad reality</a></li>
  </ul></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection">Reflection</a>
  <ul class="collapse">
  <li><a href="#p.d." id="toc-p.d." class="nav-link" data-scroll-target="#p.d.">P.D.</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Stochastic Inventory Modelling: A Tutorial for Dummies using R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 9, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Strangely enough, two years ago I was wandering in the college library thinking <em>“what do quality engineers do?”</em>; in my mind it’s common for me to be wondering that given the nature of my undergraduate degree (biotech engineer). Reading about it I stumbled with terms like Lean Six Sigma, DMAIC, SKUs, KPIs, etc…, but I wasn’t compelled because I read a word that made me turn my stomach. <strong><em>Gurus</em></strong>. I couldn’t handle that word at the time. <em>“How can a serious book for engineers follow someone known as a guru”</em> I thought. I wouldn’t have imagined that 2 years from that moment I would be digging into philosophies from these gurus — being Juran’s my favorite.</p>
<p>A big part of quality is <strong>Inventory management</strong>, and that’s the topic for my second blog. This is the objective: teach you how to make a simulation of a beer business model for its inventory management using <strong>R + tidyverse</strong>. You cannot be vague nor lie to a computer; so if you program it, you know it.</p>
<p>This blog is heavily influenced by <span class="citation" data-cites="vandeput2020">Vandeput (<a href="#ref-vandeput2020" role="doc-biblioref">2020</a>)</span> fantastic book about inventory optimization — I am half through it. If you want get into inventory theory I fully recommend this book, he really explains it phenomenally.</p>
<p>We will be using the next packages:</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># for data manipulation, plotting, etc...</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)        <span class="co"># for better tables</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)    <span class="co"># for graphs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="beer-business" class="level1">
<h1>Beer business</h1>
<p>Beer companies have five principal raw materials that they have to order from their suppliers: malt, hops, yeast, bottles, and caps. But:</p>
<ul>
<li>When should they order?</li>
<li>How much should they order?</li>
</ul>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Where should I order?
</div>
</div>
<div class="callout-body-container callout-body">
<p>This question is also key in inventory management but it is out of the scope of this article.</p>
</div>
</div>
<p>These are the questions to ask for their inventory management; if they do not handle it well they will have dead stock, and bad service for their clients. But how can they answer them? There are three variables to keep in mind:</p>
<ul>
<li>The <strong>costs</strong> of the raw materials, <span class="math inline">\(c\)</span></li>
<li>The <strong>demand</strong> of the customers, <span class="math inline">\(d\)</span></li>
<li>The <strong>lead time</strong> for the materials to arrive at the warehouse, <span class="math inline">\(L\)</span></li>
</ul>
<p>The model we will be building is to optimize for these three variables and answer those questions. In order to make a model we have to get some straight rules about the beer business we are simulating, which we will call Dr.House Brewer, we need an <strong>Inventory Policy</strong>, otherwise it will be hell to model it. Always some order is a good thing for companies.</p>
<section id="inventory-policy-periodic-review-order-up-to-level-r-s" class="level2">
<h2 class="anchored" data-anchor-id="inventory-policy-periodic-review-order-up-to-level-r-s">Inventory policy: Periodic Review &amp; Order Up-to Level (R, S)</h2>
<p>While there are many policies, Dr.House Brewer has a very popperian philosophy and does not trust new innovative policies that promise to increase its ROI by 100%, NO, the company adopts the common <em>Periodic Review &amp; Order Up-to Level</em> policy. If you go to Walmart on a specific day of the week to stock up on groceries, you are following Periodic Review &amp; Order Up-to Level policy. It consists of a periodic time interval (say every 5 workdays), <span class="math inline">\(R\)</span>, when you reorder all your inventory with your suppliers (fixed schedule) and an <strong>up-to level reorder point</strong>, <span class="math inline">\(S\)</span> (you always want to have 10 eggs, you have right now 2, you wait until it is Monday (your reorder time, <span class="math inline">\(R\)</span>) to buy your 8 eggs; 10 eggs is your <strong>up-to level reorder point</strong>, <span class="math inline">\(S\)</span>). This policy is usually written as <span class="math inline">\((R,S)\)</span>, <span class="math inline">\(R\)</span> for review period and <span class="math inline">\(S\)</span> for up-to level reorder point.</p>
<section id="simulation-time-r-s-policy-in-r" class="level3">
<h3 class="anchored" data-anchor-id="simulation-time-r-s-policy-in-r">Simulation time: (R, S) policy in R</h3>
<p>We will assume two things:</p>
<ul>
<li>The <strong>demand</strong> of the customers, <span class="math inline">\(d\)</span>, is constant/fixed</li>
<li>The <strong>lead time</strong> for the materials to arrive at the warehouse, <span class="math inline">\(l\)</span>, does NOT exist</li>
</ul>
<p>These are strong assumptions that are going to be a key point latter in this blog. Let’s think of <span class="math inline">\(l\)</span>; if there is no lead time, <span class="math inline">\(l = 0\)</span>, the moment it is your reorder time, <span class="math inline">\(R\)</span>, is the moment you get it. This is never the case, but we are going to assume it for the moment.</p>
<p>We need to define the demand, <span class="math inline">\(d\)</span>, the time period (in this daily case), <span class="math inline">\(R\)</span> and <span class="math inline">\(S\)</span>, so…,</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>s        <span class="ot">&lt;-</span> <span class="dv">14</span>  <span class="co"># order-up-to level (14 units)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>r_period <span class="ot">&lt;-</span> <span class="dv">5</span>   <span class="co"># review period (every 5 days)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>demand   <span class="ot">&lt;-</span> <span class="dv">2</span>   <span class="co"># constant daily demand</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>n_days   <span class="ot">&lt;-</span> <span class="dv">24</span>  <span class="co"># number of days to simulate</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors for the simulation</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>days         <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n_days</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>inventory    <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)  <span class="co"># the storage of the data</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>inventory[<span class="dv">1</span>] <span class="ot">&lt;-</span> s                <span class="co"># Start with order-up-to level</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Fantastic, we want a plot of how inventory changes over time using the (R, S) policy, so it will be our dependent variable. I’ll show you the code, try to understand it, then I’ll explain the logic behind it:</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_days) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((i <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%%</span> r_period <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> i <span class="sc">&gt;</span> <span class="dv">1</span>) { <span class="co"># "%%"-&gt; modulus operation so if 7 %% 3 = 1</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replenish to order-up-to level, s:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    inventory[i] <span class="ot">&lt;-</span> s                 </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Carry forward previous day's ending inventory:</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    inventory[i] <span class="ot">&lt;-</span> inventory[i <span class="sc">-</span> <span class="dv">1</span>]  </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Consume demand at end of the day:</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  inventory[i] <span class="ot">&lt;-</span> inventory[i] <span class="sc">-</span> demand</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print it</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Day"</span>, i, <span class="st">": Inventory after demand ="</span>, inventory[i], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Day 1 : Inventory after demand = 12 
Day 2 : Inventory after demand = 10 
Day 3 : Inventory after demand = 8 
Day 4 : Inventory after demand = 6 
Day 5 : Inventory after demand = 4 
Day 6 : Inventory after demand = 12 
Day 7 : Inventory after demand = 10 
Day 8 : Inventory after demand = 8 
Day 9 : Inventory after demand = 6 
Day 10 : Inventory after demand = 4 
Day 11 : Inventory after demand = 12 
Day 12 : Inventory after demand = 10 
Day 13 : Inventory after demand = 8 
Day 14 : Inventory after demand = 6 
Day 15 : Inventory after demand = 4 
Day 16 : Inventory after demand = 12 
Day 17 : Inventory after demand = 10 
Day 18 : Inventory after demand = 8 
Day 19 : Inventory after demand = 6 
Day 20 : Inventory after demand = 4 
Day 21 : Inventory after demand = 12 
Day 22 : Inventory after demand = 10 
Day 23 : Inventory after demand = 8 
Day 24 : Inventory after demand = 6 </code></pre>
</div>
</div>
<p><strong>Logic:</strong> our inventory array will be decreasing per day given the constant demand, but given that we have a periodic review, <span class="math inline">\(R\)</span>, the moment it is <span class="math inline">\(R\)</span>-day the moment it replenishes your inventory (remember we won’t be waiting any time between order and the supplies arriving at the warehouse, there is no <strong>lead time</strong>) to an up-to level reorder point, <span class="math inline">\(S\)</span>. We need a for-loop that will help us evaluate whether the inventory per <em>i</em> day. A day is composed of mornings and evenings; in the morning we evaluate whether it is <span class="math inline">\(R\)</span>-day or not, this is what the first condition does <code>(i - 1) %% r_period</code>; inside the loop:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 24%">
<col style="width: 12%">
<col style="width: 51%">
</colgroup>
<thead>
<tr class="header">
<th>Day</th>
<th>Evaluation</th>
<th>Result</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>i = 1</code></td>
<td><code>(1-1) %% 5</code> = 0</td>
<td><code>False</code></td>
<td>but we exclude day 1 with <code>&amp;&amp; i &gt; 1</code></td>
</tr>
<tr class="even">
<td><code>i = 2</code></td>
<td><code>(2-1) %% 5</code> = 1</td>
<td><code>False</code></td>
<td>-</td>
</tr>
<tr class="odd">
<td><code>i = 3</code></td>
<td><code>(3-1) %% 5</code> = 2</td>
<td><code>False</code></td>
<td>-</td>
</tr>
<tr class="even">
<td><code>.....</code></td>
<td><code>.....</code></td>
<td><code>.....</code></td>
<td><code>.....</code></td>
</tr>
<tr class="odd">
<td><code>i = 6</code></td>
<td><code>(6-1) %% 5</code> = 0</td>
<td><code>True</code></td>
<td>equal to 0</td>
</tr>
</tbody>
</table>
<p>The next conditional, <code>else if (i &gt; 1)</code> , is just saying <em>“Is this NOT the first day AND NOT a review day? If YES, start with yesterday’s leftover inventory”</em>. Then by the end of the day we have <code>inventory[i] - demand</code> inventory.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can make this for-loop a function with <code>simulate_inventory &lt;- function(s, r_period, demand, n_days)</code> as parameters, if you want.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tidy data fram, called tibble</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>inventory_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">days =</span> days,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">inventory =</span> inventory</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the inventory over time</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>plot_1 <span class="ot">&lt;-</span> inventory_data <span class="sc">|&gt;</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(days, inventory)) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Inventory Levels Over Time"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"(R,S) Policy: Review every"</span>, r_period, <span class="st">"days, Order up to"</span>, s, <span class="st">"units"</span>),</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Days"</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Inventory Level"</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, n_days, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="dv">5</span>, n_days, r_period), </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">5</span>, n_days, r_period), <span class="at">y =</span> s <span class="sc">+</span> <span class="dv">1</span>, </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Reorder"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>plot_1 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-plot1-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: (R,S) simulation. Note how it never gets S = 14 [units]; because the simulation gives the inventory AFTER the review, or at the end of the day. So after R-day next day in the morning you have 14 but you will be consuming 2, given the daily demand, which makes it 12 [units] in the inventory
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-plot1" class="quarto-xref">Figure&nbsp;1</a> shows the plot of inventory vs time. Note how the assumptions affect the simulation: there is an instantaneous replenishment of the inventory level and the inventory level is decreasing uniformly (just a straight line) given constant daily demand. This policy does not show fluctuations in time, but it can be risky because you can get into red levels of inventory level given an unexpected increase in demand and being far from <span class="math inline">\(R\)</span>-day (or any given time-period).</p>
<p>Dr.House Brewer has chosen its policy, how can it be optimized?</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Inventory Level</strong> is the net inventory: available on-hand inventory and in-transit inventory, minus back-orders, orders not yet shipped, etc.</p>
</div>
</div>
</section>
</section>
</section>
<section id="supply-chains-inventories" class="level1">
<h1>Supply chains &amp; Inventories</h1>
<p>There are three topics to keep in mind in the supply chain: suppliers, warehouse, and customers (<a href="#fig-plot2" class="quarto-xref">Figure&nbsp;2</a>). The important question for us, the inventory managers at Dr.House Brewery warehouse, is to ask: **_ How much should I order?_**. We have a policy, but how can we plan it? It turns out this isn’t an easy question to answer, because as the population increases, so do the customers, the suppliers and the warehouses, and big companies have it tough. That’s why we need a model that can help us navigate this complex supply chains.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">make_graph</span>(<span class="sc">~</span><span class="st">"Suppliers"</span><span class="sc">-+</span><span class="st">"Warehouse"</span>, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Warehouse"</span><span class="sc">-+</span><span class="st">"Customers"</span>) <span class="co"># - means line &amp; + means arrow</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g1, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">layout =</span> <span class="fu">layout_as_tree</span>(g1),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.color =</span> <span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"red"</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.size =</span> <span class="dv">35</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.arrow.size =</span> <span class="fl">0.8</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.cex =</span> <span class="fl">1.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-plot2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Typical supply chain. Keep in mind there can be n suppliers, warehouses, and customers
</figcaption>
</figure>
</div>
</div>
</div>
<section id="economic-order-quantity-eoq-model" class="level2">
<h2 class="anchored" data-anchor-id="economic-order-quantity-eoq-model">Economic Order Quantity (EOQ) model</h2>
<p><em>How much should I order?</em> turned out to be depending on the costs!!! — it is always about money.</p>
<p><span class="math display">\[
C(Q)
\]</span></p>
<p>Where <span class="math inline">\(C\)</span> is cost, and <span class="math inline">\(Q\)</span> is order quantity. There is two types of costs:</p>
<ul>
<li><p><strong>Holding costs</strong>. Costs associated with storing products. Two types:</p>
<ul>
<li><p><strong>Variable holding costs</strong> (e.g.&nbsp;losses)</p></li>
<li><p><strong>Fixed holding costs</strong> (e.g.&nbsp;employees)</p></li>
</ul></li>
<li><p><strong>Transaction Costs</strong>. All costs associated with ordering the product from the suppliers. Not only transportation. Two types:</p>
<ul>
<li><p><strong>Variable transaction costs</strong> (e.g.&nbsp;packaging)</p></li>
<li><p><strong>Fixed transaction costs</strong> (e.g.&nbsp;fixed fees)</p></li>
</ul></li>
</ul>
<p>We won’t be caring for <strong>Variable transaction costs</strong> because they do not depend on <span class="math inline">\(Q\)</span> (they depend on the demand, <span class="math inline">\(d\)</span>). This is the equation:</p>
<p><span class="math display">\[
Total Costs = Holding Costs + Transaction Costs
\]</span></p>
<p><span class="math display">\[
\longrightarrow C(Q) = h \frac {Q}{2} + k \frac{D}{Q}
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dimensional Analysis for the engineers out there:
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math display">\[
C(Q) = \left( \frac {[currency]} {[unit]  [time]} * \frac {[item]}{1} \right) +  \left( \frac{[currency]}{[order]} * \frac {[unit]}{[time]} * \frac{1}{[unit]}      \right)
\]</span></p>
<p>Since <span class="math inline">\([order]\)</span> is a count, it is often considered dimensionally defined as equivalent to a pure number, dimensionless.</p>
<p><span class="math display">\[
C(Q) = \left( \frac {[currency]} {[unit]  [time]} * \frac {[item]}{1} \right) +  \left( \frac{[currency]}{1} * \frac {[unit]}{[time]} * \frac{1}{[unit]}      \right)
\]</span></p>
<p><span class="math display">\[
= \frac{[currency] }{[time]}  +  \frac{[currency] }{[time]}  = \frac{[currency] }{[time]}
\]</span></p>
</div>
</div>
<section id="what-does-it-all-mean" class="level3">
<h3 class="anchored" data-anchor-id="what-does-it-all-mean">What does it all mean?</h3>
<p>I won’t be focusing on the code, for the moment (it is relatively easy this chunk of code), because it isn’t really important. What is important is understanding the EOQ equation (<span class="math inline">\(C(Q)\)</span>). So let’s focus on the plots:</p>
<div class="cell" data-layout="[[45,-10,45],[100]]">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># EOQ: total cost = holding costs + transactions costs</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fl">0.5</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>eoc_m <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">q =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="fl">0.1</span>),         <span class="co"># Order quantity</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">h_cost =</span> (h) <span class="sc">*</span> (q<span class="sc">/</span><span class="dv">2</span>),        <span class="co"># Holding cost</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">t_cost =</span> k <span class="sc">*</span> (demand<span class="sc">/</span>q),     <span class="co"># Transaction cost</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_cost =</span> h_cost <span class="sc">+</span> t_cost <span class="co"># Total costs</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>plot_2 <span class="ot">&lt;-</span> eoc_m <span class="sc">|&gt;</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(q, h_cost)) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"darkorange"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Holding cost: (h) * (q/2)"</span>,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Cost"</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Order quantity"</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>plot_3 <span class="ot">&lt;-</span>  eoc_m <span class="sc">|&gt;</span> </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(q, t_cost))<span class="sc">+</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cyan3"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Transaction costs:  k * (demand/q)"</span>,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Order quantity"</span>,</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cost"</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Make it in long format for the labels in the ggplot</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>plot_4 <span class="ot">&lt;-</span> eoc_m <span class="sc">|&gt;</span> <span class="fu">pivot_longer</span>(</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="fu">c</span>(h_cost, t_cost, total_cost), </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">"cost_type"</span>, </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">"cost_value"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cost_type =</span> <span class="fu">factor</span>(cost_type, </span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"h_cost"</span>, <span class="st">"t_cost"</span>, <span class="st">"total_cost"</span>),</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>                              <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Holding Cost"</span>, <span class="st">"Transaction Cost"</span>, <span class="st">"Total Cost"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> q, <span class="at">y =</span> cost_value, <span class="at">color =</span> cost_type)) <span class="sc">+</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Holding Cost"</span> <span class="ot">=</span> <span class="st">"darkorange"</span>,</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"Transaction Cost"</span> <span class="ot">=</span> <span class="st">"cyan3"</span>,</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"Total Cost"</span> <span class="ot">=</span> <span class="st">"dodgerblue4"</span>)) <span class="sc">+</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Order quantity"</span>,</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Costs"</span>,</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"Cost Type:"</span>,</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Economic Order Quantity (EOQ) Cost Analysis"</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="fl">3.5</span>), </span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">3.3</span>, <span class="at">y =</span> <span class="fl">0.68</span>, <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"Optim. Area"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co"># Position legend at bottom</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>plot_2</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>plot_3</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>plot_4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-plots" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-plots" style="flex-basis: 45.0%;justify-content: flex-start;">
<div id="fig-plots-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-plots-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-plots-1.png" class="img-fluid figure-img" data-ref-parent="fig-plots" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-plots-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Propotionality
</figcaption>
</figure>
</div>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 10.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-plots" style="flex-basis: 45.0%;justify-content: flex-start;">
<div id="fig-plots-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-plots-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-plots-2.png" class="img-fluid figure-img" data-ref-parent="fig-plots" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-plots-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Inversely proporsional
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-plots" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-plots-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-plots-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-plots-3.png" class="img-fluid figure-img" data-ref-parent="fig-plots" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-plots-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Combine variables
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: EOQ model
</figcaption>
</figure>
</div>
</div>
<p>Holding costs are easy to understand (look at <a href="#fig-plots-1" class="quarto-xref">Figure&nbsp;3 (a)</a>); as you increase the order quantity, the more your inventory, therefore more holding costs. But what about transaction cost (<a href="#fig-plots-2" class="quarto-xref">Figure&nbsp;3 (b)</a>); imagine you increase the order of hoops for the brewery, the more you increase the order quantity the less transactions with your supplier, but it has a limit. Combine, the total costs (<a href="#fig-plots-3" class="quarto-xref">Figure&nbsp;3 (c)</a>), we can observe that there is minimum, which is point we want to archive; this minimum is in a big somewhat flat area, this is great for the practitioner (us)!, it means that there is room for being wrong and the same time not being so wrong. We can obtain the minimum by deriving total costs function over <span class="math inline">\(Q\)</span>. This is the derived equation (we will call it <span class="math inline">\(Q^{*}\)</span>, “q-star”):</p>
<p><span id="eq-qstar"><span class="math display">\[
\frac{dC }{dQ} = Q^{*}  =  \sqrt[2]{\frac{2kd}{h}}
\tag{1}\]</span></span></p>
<p>This means that in order to optimize the order quantity, <span class="math inline">\(Q^*\)</span>, you want to avoid the transaction costs by increasing the order quantity, BUT, you don’t want to overdo it because by increasing the <span class="math inline">\(Q\)</span>, you increase the holding costs <span class="math inline">\(h\)</span> (there will just be too many inventory to handle). As with much in life, it is a <strong>balance</strong>.</p>
<p>We can replace <span class="math inline">\(Q^{*}\)</span> in <a href="#eq-qstar" class="quarto-xref">Equation&nbsp;1</a> to find the minimum cost — we won’t do it.</p>
<p>However, all of this is quite far from reality, and that’s okay!!! These kinds of models (deterministic models), in my opinion, are not meant to forecast with infinite precision the phenomena; instead they are meant to make some sense of it and build some intuition, which is often more valuable than doing the model itself. That’s why it is worth learning them.</p>
</section>
</section>
</section>
<section id="stochastic-modelling-or-a-number-isnt-just-a-number" class="level1">
<h1>Stochastic modelling or <em>A number isn’t just a number</em></h1>
<p>Here are the assumptions we have made so far:</p>
<ul>
<li>The <strong>demand</strong>, <span class="math inline">\(d\)</span>, is constant</li>
<li>There is no <strong>lead time</strong>, <span class="math inline">\(l\)</span>, (the waiting time for the supplies to arrive since the order is made)</li>
</ul>
<p>They are strong assumptions because in reality the demand is variable, and there is lead time which is also variable. We are going to incorporate these assumptions into the model, making it stochastic. Stochastic is just another word for randomness, and a stochastic model is just the incorporation of random variables (in this case <span class="math inline">\(d\)</span>, and <span class="math inline">\(l\)</span>) to the model. Why? It helps us deal with uncertainty.</p>
<p>e.g.&nbsp;Imagine we want to estimate how much should we order. We use the derived <span class="math inline">\(Q*\)</span> to make an estimate, but that estimate can be interpreted as an average of a normal distribution; if we use it we are saying there is still a 50% cumulative probability that there will not be enough <strong>on-hand</strong> inventory to cover the demand. No good news. In other words, you are gambling that you will have enough on-hand inventory by tossing a coin. This scenario is too risky but that risk can be manageable by taking into account in the model the same uncertainty. Rephrasing: Stochastic models help us make decisions under uncertainty. We will still be making plenty of assumptions but at least this model is more fit for real-case scenarios</p>
<section id="the-normal-distribution-plus-words-of-caution" class="level2">
<h2 class="anchored" data-anchor-id="the-normal-distribution-plus-words-of-caution">The normal distribution plus words of caution</h2>
<p>We will be assuming that <strong>demand</strong>, <span class="math inline">\(d\)</span>, and <strong>lead time</strong>, <span class="math inline">\(l\)</span>, have a normal distribution. Therefore we have to know what the normal distribution is saying. If you know what a PDF, CDF, and quantiles are, you can skip this part.</p>
<section id="hyperparameters" class="level3">
<h3 class="anchored" data-anchor-id="hyperparameters">Hyperparameters</h3>
<p>Here is a controversial opinion, I do not like the Normal distribution. I am done, I said it. It just tells there is an expected value, the mean <span class="math inline">\(\mu\)</span>, and perturbations around it, the standard deviation <span class="math inline">\(\sigma^2\)</span>. That phrasing can be applied to every single stuff, and I am very cautious when the universality principle can be applied, also in a way you are expressing ignorance because if you only know that there is perturbations around a mean, you don’t know how that perturbations are behaving, which is the idea, capture that uncertainty of the phenomena. Having said that, normal distributions are very helpful to make estimates despite its universality — also they are wildly use because of the central limit theorem which ultimately says that every phenomena will behave as a normal distribution as data is gathered to infinite. So assuming normality for <strong>demand</strong>, <span class="math inline">\(d\)</span>, and <strong>lead time</strong>, <span class="math inline">\(l\)</span> variables:</p>
<p><span class="math display">\[
d \sim N(\mu_{d}, \sigma_{d}^{2})
\]</span></p>
<p><span class="math display">\[
l\sim N(\mu_{l}, \sigma_{l}^{2})
\]</span></p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>More about skepticism about normal distributions can be found in <span class="citation" data-cites="taleb2007">Taleb (<a href="#ref-taleb2007" role="doc-biblioref">2007</a>)</span> book the Black Swan, term taken from the classical problem of inference, Hume’s problem. If you like science you should know it.</p>
</div>
</div>
</div>
<p>We can read the last equations as “demand and lead time follows a normal distribution of with <strong>hyperparameters</strong> mean <span class="math inline">\(\mu_x\)</span> and standard deviation <span class="math inline">\(\sigma^{2}_{x}\)</span>”. We will only care for the hyperparameters, nothing else, just to make it simple and not dealing with a lot of algebra, also because we can describe this distribution just with these hyperparameters, like in <a href="#fig-plot3" class="quarto-xref">Figure&nbsp;4</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the normal distribution</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>x_norm <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="fl">0.01</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">norm1 =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>), <span class="co"># this is called the "standard" normal distribution</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">norm2 =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">norm3 =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Look how we just modify the the hyperparameters</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>plot_5 <span class="ot">&lt;-</span> x_norm <span class="sc">|&gt;</span> </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> norm1), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> norm2), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> norm3), <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Normal distributions"</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Probability"</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>plot_5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-plot3-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Three normal distributions
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="pdf-cdf" class="level3">
<h3 class="anchored" data-anchor-id="pdf-cdf">PDF &amp; CDF</h3>
<p>The normal distribution is a Probability <em>Density</em> Function (PDF). That word, density, is important because it tell us that a normal distribution can take a continuous array of values; if we are saying that demand follows a normal distribution we are saying that it can take continuous values. This is not the case: “please give me 2.12419 kegs of beer”, that does not make sense. This is another assumption that we are explicitly making.</p>
<p>Another important subject is a Cumulative Density Function (CDF). Every PDF has its CDF. They are just the accumulative probability of of its relative PDF. <a href="#fig-plot4" class="quarto-xref">Figure&nbsp;5</a> shows both a PDF and CDF of a standardized normal distribution, <span class="math inline">\(X \sim N(\mu = 0, \sigma^2 = 1)\)</span>. CDFs are important because they help access the risk of choosing a value within our normal distribution, or any PDF.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data for both PDF and CDF</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df_combined <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">0.01</span>),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pdf =</span> <span class="fu">dnorm</span>(x),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cdf =</span> <span class="fu">pnorm</span>(x)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>plot_6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_combined, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pdf, <span class="at">color =</span> <span class="st">"PDF"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> cdf <span class="sc">*</span> <span class="fu">max</span>(pdf), <span class="at">color =</span> <span class="st">"CDF"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Probability Density (PDF)"</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>.<span class="sc">/</span><span class="fu">max</span>(df_combined<span class="sc">$</span>pdf), </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">"Cumulative Probability (CDF)"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> scales<span class="sc">::</span>percent)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PDF"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>, <span class="st">"CDF"</span> <span class="ot">=</span> <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Standard Normal Distribution: PDF and CDF"</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Standard Deviations from Mean"</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Function"</span>) <span class="sc">+</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"orange"</span>),</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"orange"</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>plot_6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-plot4-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Normal PDF and CDF. Look how the mean is half of the CDF, so it’s saying that you capture half the probability of any given event that follows a normal PDF
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="quantiles-normal-rule-of-thumb" class="level3">
<h3 class="anchored" data-anchor-id="quantiles-normal-rule-of-thumb">Quantiles &amp; normal rule of thumb</h3>
<p>There is another property of big importance. While CDFs describe the cumulative probability of a PDF within a range of values, quantiles describe specific points that divide the range of a PDF into equal probabilities. In a normal PDF there is a rule of thumb called <em>68–95–99.7 rule</em>, which says that in the quantile <span class="math inline">\(\pm 1\sigma\)</span> we capture 68% of probabilities of any normal distribution, in <span class="math inline">\(\pm 2\sigma\)</span> 95% and <span class="math inline">\(\pm 3\sigma\)</span> 99.7%.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data for standard normal distribution</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">length.out =</span> <span class="dv">1000</span>), <span class="at">y =</span> <span class="fu">dnorm</span>(x))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the first plot with empirical rule</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>plot_7 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add shaded regions for empirical rule</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(x <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">1</span>), </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(x <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">2</span>), </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(x <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">3</span>), </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"lightpink"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add vertical lines for mean and standard deviations</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add annotations</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.1</span>, <span class="at">label =</span> <span class="st">"Mean (μ = 0)"</span>, </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">label =</span> <span class="st">"68% within ±1σ"</span>, </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">label =</span> <span class="st">"95% within ±2σ"</span>, </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="fl">0.2</span>, <span class="at">label =</span> <span class="st">"99.7% within ±3σ"</span>, </span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Customize theme and labels</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Standard Normal Distribution with quantiles"</span>,</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"68-95-99.7 Rule (One, Two, Three Standard Deviations)"</span>,</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Standard Deviations from Mean"</span>, </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>plot_7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-plot5-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: 68–95–99.7 rule. Notice how the quantiles divide the normal distribution in equal length.
</figcaption>
</figure>
</div>
</div>
</div>
<p>If you think a quantile is just another way of describing a CDF, you are not alone, it is a common misconception. They are closely related and this relationship will become important. While a CDF function, <span class="math inline">\(F(x)\)</span>, computes the cumulative range of probabilities, <span class="math inline">\(p\)</span>, that are bigger or equal of <span class="math inline">\(x\)</span>, <span class="math inline">\(P(X \le  x) = F(x) = p\)</span>; a quantile function computes the value, <span class="math inline">\(x\)</span>, to obtain a range of probabilities <span class="math inline">\(p\)</span>. In other words a quantile function is the inverse of the CDF function, <span class="math inline">\(F^{-1}(p) = x\)</span>. This is the explicit relationship:</p>
<p><span id="eq-inversecdf"><span class="math display">\[
F(x) = p  \quad \leftrightharpoons  \quad F^{-1}(p) = x
\tag{2}\]</span></span></p>
</section>
</section>
<section id="stochastic-eoq-model" class="level2">
<h2 class="anchored" data-anchor-id="stochastic-eoq-model">Stochastic EOQ model</h2>
<p>The objective in transforming the EOQ model into a stochastic model is to increase the quality of our <strong>service level</strong>, which means serving our clients in time and full. Remember we are considering demand and lead time as random variables for the model.</p>
<p><span class="math display">\[
d \sim N(\mu_{d}, \sigma_{d}^{2})
\]</span></p>
<p><span class="math display">\[
l\sim N(\mu_{l}, \sigma_{l}^{2})
\]</span></p>
<section id="service-level-alpha-safety-stocks" class="level3">
<h3 class="anchored" data-anchor-id="service-level-alpha-safety-stocks">Service Level (<span class="math inline">\(\alpha\)</span>) &amp; Safety Stocks</h3>
<p><strong>Safety stocks</strong>, <span class="math inline">\(S_s\)</span>, are a very useful buffer when we face an unusual demand. They are extra on hand inventory as a backup when we finish our predicted inventory level. They are related with the service level, <span class="math inline">\(\alpha\)</span>, which is often expressed as percentage. How do they relate? Well by this seem to be complex equation:</p>
<p><span id="eq-ss"><span class="math display">\[
S_{s} = Z_{\alpha}\sigma_{l_{d}}
\tag{3}\]</span></span></p>
<p>Let’s understand this equation</p>
<p><strong>Factor service level</strong>, <span class="math inline">\(Z_{\alpha}\)</span>:</p>
<p>What does it mean wanting to have 95% of service level, <span class="math inline">\(\alpha\)</span>?</p>
<p>We have periodic demand that follows a normal distribution.</p>
<p><span class="math display">\[
d \sim N(\mu_{d}, \sigma_{d})
\]</span></p>
<p>If we compute the CDF of <span class="math inline">\(d\)</span> for any given value <span class="math inline">\(x\)</span>, it will provide us with the probability that will below of <span class="math inline">\(x\)</span>. We want to be extra sure about our computation of <span class="math inline">\(x\)</span>, we want 95% of confidence/probability about <span class="math inline">\(x\)</span>. We already know <span class="math inline">\(d\)</span> (a.k.a the probability density of demand) and we know that our objective is 95% (a.k.a. <span class="math inline">\(\alpha\)</span>); we don’t want the CDF we want the quantile function.</p>
<p><span id="eq-alpha"><span class="math display">\[
F_{d}(z) = \alpha \rightarrow F_{d}^{-1} (\alpha) = z
\tag{4}\]</span></span></p>
<p>This is the same property as in <a href="#eq-inversecdf" class="quarto-xref">Equation&nbsp;2</a> but applied to the demand distribution. <a href="#eq-alpha" class="quarto-xref">Equation&nbsp;4</a> is equal to the standard normal quantile function (<span class="math inline">\(\Phi(\alpha)\)</span>)</p>
<p><span id="eq-factorServiceLevel"><span class="math display">\[
F_{d}^{-1}(\alpha) = \Phi^{-1}(\alpha) = z_{\alpha}
\tag{5}\]</span></span></p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p><span class="math inline">\(d\)</span> can be computed from historical demand or by a forecast</p>
</div>
</div>
</div>
<p><strong>What about the other term, in</strong> <a href="#eq-ss" class="quarto-xref">Equation&nbsp;3</a> ?:</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Many probability theory terms coming. Read them, try to understand them. They are confusing. I would give at the end a way of how you can think of them intuitively.</p>
</div>
</div>
<p><span class="math inline">\(Z_\alpha\)</span> is just a factor term that will be multiplied by <span class="math inline">\(\sigma_{d_{l}}\)</span>, which can be interpreted as the <em>variability of demand, and lead time</em>. <a href="#eq-ss" class="quarto-xref">Equation&nbsp;3</a> is telling us that in order to determine the safety stocks we have to account the variability of two random variables <span class="math inline">\(l\)</span> and <span class="math inline">\(d\)</span>. To do that we need the product of two random variables collapsing into a quantity that represents the integrated variability of <span class="math inline">\(l\)</span> and <span class="math inline">\(d\)</span>. <strong>How to think about it:</strong> <span class="math inline">\(\sigma_{d_{l}}\)</span> is the area of risk of an inventory policy, the factor <span class="math inline">\(Z_{\alpha}\)</span> determines how much risk are we willing to minimize, the more we want to minimize (by increasing <span class="math inline">\(\alpha\)</span>, service level), the more safety stocks, BUT, the more inventory costs by the holding costs. Something that you have to get clear is that safety stocks is the tool that help us battle the variability of the demand, making them essential to give an optimal service level.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Getting more precise
</div>
</div>
<div class="callout-body-container callout-body">
<p>With <span class="math inline">\(\sigma_{d_{l}}\)</span> I am not referring to joint PDF, instead I am referring to a product two random variables (in this case <span class="math inline">\(\sigma_{d}\)</span> and <span class="math inline">\(\sigma_{l}\)</span>) which does not create any new distribution, it just describes an area behind the intersection between this two random variables, <span class="math inline">\(l\)</span> and <span class="math inline">\(d\)</span>, which accounts their variability, which would be multiplied by <span class="math inline">\(Z_\alpha\)</span> factor to make sure we are <span class="math inline">\(\alpha\)</span> secure of the computation of the safety stocks. If you want to know more about this derivation, search for “product of Gaussians” or “product of random variables”.</p>
<p>I write this note because at the beginning I was confused between the difference of a joint PDF, a sum of random variables (convolution) and the product of random variables.</p>
</div>
</div>
</section>
<section id="integrating-the-s-r-policy" class="level3">
<h3 class="anchored" data-anchor-id="integrating-the-s-r-policy">Integrating the (S, R) policy</h3>
<p>The derivation of <span class="math inline">\(\sigma_{d_{l}}\)</span> depends on the inventory policy. The <span class="math inline">\((S, R)\)</span> policy is particularly riskier than others because the risk time is the moment when you make an order for your suppliers, every <span class="math inline">\(R\)</span> period, till the moment it arrives (every <span class="math inline">\(l\)</span>, lead time). So the risk period is: <span class="math inline">\(R + l\)</span>. I will show the derived equation:</p>
<p><span id="eq-ssSR"><span class="math display">\[
S_{s} = Z_{\alpha}\sigma_{l_{d}} = Z_{\alpha} \sqrt{(\mu_{l} + R)\sigma_{d}^{2} + \sigma_{l}^{2}\mu_{d}^{2}}
\tag{6}\]</span></span></p>
</section>
</section>
</section>
<section id="dr.house-brewery-s-r-stochastic-policy-simulation" class="level1">
<h1>Dr.House brewery (S, R) stochastic policy simulation</h1>
<p>After all this heavy literature recap, I hope you aren’t too destroyed by it, this is the start of the simulation.</p>
<section id="setting-up-the-variables" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-the-variables">1) Setting up the variables</h2>
<p>Dr.House brewery wants to simulate its daily <strong>net inventory</strong>:</p>
<p><span id="eq-net"><span class="math display">\[
net\ inventory = on\ hand\ inventory\ + in\ transit\ inventory\ - backorders
\tag{7}\]</span></span></p>
<p>But before starting they made some research and obtained the below parameters shown in the table. Notice the choice of using a service level, <span class="math inline">\(\alpha\)</span>, of 95% (remember the importance of <span class="math inline">\(\alpha\)</span> for calculating safety stocks <a href="#eq-ss" class="quarto-xref">Equation&nbsp;3</a>).</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Define Lead time and </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)         <span class="co"># For reproducibility</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">365</span>               <span class="co"># days</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>d_mu <span class="ot">&lt;-</span> <span class="dv">100</span>; l_mu <span class="ot">=</span> <span class="dv">4</span>  <span class="co"># daily demand [units/day]</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>d_std <span class="ot">&lt;-</span> <span class="dv">25</span>; l_std <span class="ot">=</span> <span class="dv">1</span> <span class="co"># daily lead time </span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters:</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">100</span>, <span class="co"># fixed cost of a single transaction [$/order] </span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fl">0.5</span>, <span class="co"># yearly holding costs for keeping one single piece in stock [$/unit * year]</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_yearly =</span> <span class="dv">365</span> <span class="sc">*</span> d_mu, <span class="co"># yearly expected demand</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.95</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the parameter table using gt package</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>parameter_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parameter =</span> <span class="fu">c</span>(<span class="st">"t"</span>, <span class="st">"d_mu"</span>, <span class="st">"l_mu"</span>, <span class="st">"d_std"</span>, <span class="st">"l_std"</span>, <span class="st">"k"</span>, <span class="st">"h"</span>, <span class="st">"d_yearly"</span>, <span class="st">"alpha"</span>),</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(t, d_mu, l_mu, d_std, l_std, params<span class="sc">$</span>k, params<span class="sc">$</span>h, params<span class="sc">$</span>d_yearly, params<span class="sc">$</span>alpha),</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Units =</span> <span class="fu">c</span>(<span class="st">"days"</span>, <span class="st">"units/day"</span>, <span class="st">"days"</span>, <span class="st">"units/day"</span>, <span class="st">"days"</span>, <span class="st">"$/order"</span>, <span class="st">"$/(unit*year)"</span>, <span class="st">"units/year"</span>, <span class="st">"dimensionless"</span>),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Meaning =</span> <span class="fu">c</span>(</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Time period (days)"</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Daily demand mean"</span>,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Lead time mean"</span>,</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Daily demand standard deviation"</span>,</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Lead time standard deviation"</span>,</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Fixed cost per order"</span>,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Yearly holding cost per unit"</span>,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Yearly expected demand"</span>,</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Service level probability"</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the gt table</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>gt_table <span class="ot">&lt;-</span> parameter_table <span class="sc">%&gt;%</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Inventory Simulation Parameters"</span>,</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Model parameters and their definitions"</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">Parameter =</span> <span class="st">"Parameter"</span>,</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">Value =</span> <span class="st">"Value"</span>,</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">Units =</span> <span class="st">"Units"</span>,</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">Meaning =</span> <span class="st">"Meaning"</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(Value),</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">2</span>,</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">drop_trailing_zeros =</span> <span class="cn">TRUE</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>),</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>()</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_fill</span>(<span class="at">color =</span> <span class="st">"#f7f7f7"</span>),</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>(<span class="at">rows =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(parameter_table), <span class="at">by =</span> <span class="dv">2</span>))</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.width =</span> <span class="fu">pct</span>(<span class="dv">95</span>),</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.align =</span> <span class="st">"left"</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>gt_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-table" class="cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-table-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="mldzawjmql" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mldzawjmql table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mldzawjmql thead, #mldzawjmql tbody, #mldzawjmql tfoot, #mldzawjmql tr, #mldzawjmql td, #mldzawjmql th {
  border-style: none;
}

#mldzawjmql p {
  margin: 0;
  padding: 0;
}

#mldzawjmql .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 95%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mldzawjmql .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mldzawjmql .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mldzawjmql .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mldzawjmql .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mldzawjmql .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mldzawjmql .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mldzawjmql .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mldzawjmql .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mldzawjmql .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mldzawjmql .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mldzawjmql .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mldzawjmql .gt_spanner_row {
  border-bottom-style: hidden;
}

#mldzawjmql .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mldzawjmql .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mldzawjmql .gt_from_md > :first-child {
  margin-top: 0;
}

#mldzawjmql .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mldzawjmql .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mldzawjmql .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mldzawjmql .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mldzawjmql .gt_row_group_first td {
  border-top-width: 2px;
}

#mldzawjmql .gt_row_group_first th {
  border-top-width: 2px;
}

#mldzawjmql .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mldzawjmql .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mldzawjmql .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mldzawjmql .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mldzawjmql .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mldzawjmql .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mldzawjmql .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mldzawjmql .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mldzawjmql .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mldzawjmql .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mldzawjmql .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mldzawjmql .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mldzawjmql .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mldzawjmql .gt_left {
  text-align: left;
}

#mldzawjmql .gt_center {
  text-align: center;
}

#mldzawjmql .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mldzawjmql .gt_font_normal {
  font-weight: normal;
}

#mldzawjmql .gt_font_bold {
  font-weight: bold;
}

#mldzawjmql .gt_font_italic {
  font-style: italic;
}

#mldzawjmql .gt_super {
  font-size: 65%;
}

#mldzawjmql .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mldzawjmql .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mldzawjmql .gt_indent_1 {
  text-indent: 5px;
}

#mldzawjmql .gt_indent_2 {
  text-indent: 10px;
}

#mldzawjmql .gt_indent_3 {
  text-indent: 15px;
}

#mldzawjmql .gt_indent_4 {
  text-indent: 20px;
}

#mldzawjmql .gt_indent_5 {
  text-indent: 25px;
}

#mldzawjmql .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mldzawjmql div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="4" class="gt_heading gt_title gt_font_normal">Inventory Simulation Parameters</th>
</tr>
<tr class="gt_heading even">
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Model parameters and their definitions</th>
</tr>
<tr class="gt_col_headings header">
<th id="Parameter" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Parameter</th>
<th id="Value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Value</th>
<th id="Units" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Units</th>
<th id="Meaning" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Meaning</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Parameter" style="background-color: #F7F7F7">t</td>
<td class="gt_row gt_right" headers="Value" style="background-color: #F7F7F7">365</td>
<td class="gt_row gt_left" headers="Units" style="background-color: #F7F7F7">days</td>
<td class="gt_row gt_left" headers="Meaning" style="background-color: #F7F7F7">Time period (days)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Parameter">d_mu</td>
<td class="gt_row gt_right" headers="Value">100</td>
<td class="gt_row gt_left" headers="Units">units/day</td>
<td class="gt_row gt_left" headers="Meaning">Daily demand mean</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Parameter" style="background-color: #F7F7F7">l_mu</td>
<td class="gt_row gt_right" headers="Value" style="background-color: #F7F7F7">4</td>
<td class="gt_row gt_left" headers="Units" style="background-color: #F7F7F7">days</td>
<td class="gt_row gt_left" headers="Meaning" style="background-color: #F7F7F7">Lead time mean</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Parameter">d_std</td>
<td class="gt_row gt_right" headers="Value">25</td>
<td class="gt_row gt_left" headers="Units">units/day</td>
<td class="gt_row gt_left" headers="Meaning">Daily demand standard deviation</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Parameter" style="background-color: #F7F7F7">l_std</td>
<td class="gt_row gt_right" headers="Value" style="background-color: #F7F7F7">1</td>
<td class="gt_row gt_left" headers="Units" style="background-color: #F7F7F7">days</td>
<td class="gt_row gt_left" headers="Meaning" style="background-color: #F7F7F7">Lead time standard deviation</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Parameter">k</td>
<td class="gt_row gt_right" headers="Value">100</td>
<td class="gt_row gt_left" headers="Units">$/order</td>
<td class="gt_row gt_left" headers="Meaning">Fixed cost per order</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Parameter" style="background-color: #F7F7F7">h</td>
<td class="gt_row gt_right" headers="Value" style="background-color: #F7F7F7">0.5</td>
<td class="gt_row gt_left" headers="Units" style="background-color: #F7F7F7">$/(unit*year)</td>
<td class="gt_row gt_left" headers="Meaning" style="background-color: #F7F7F7">Yearly holding cost per unit</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Parameter">d_yearly</td>
<td class="gt_row gt_right" headers="Value">36,500</td>
<td class="gt_row gt_left" headers="Units">units/year</td>
<td class="gt_row gt_left" headers="Meaning">Yearly expected demand</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Parameter" style="background-color: #F7F7F7">alpha</td>
<td class="gt_row gt_right" headers="Value" style="background-color: #F7F7F7">0.95</td>
<td class="gt_row gt_left" headers="Units" style="background-color: #F7F7F7">dimensionless</td>
<td class="gt_row gt_left" headers="Meaning" style="background-color: #F7F7F7">Service level probability</td>
</tr>
</tbody>
</table>

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-table-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7
</figcaption>
</figure>
</div>
</div>
</section>
<section id="estimating-s-and-r" class="level2">
<h2 class="anchored" data-anchor-id="estimating-s-and-r">2) Estimating S and R</h2>
<p>In order to make the simulation we have to compute the <span class="math inline">\(R\)</span> (review period) and <span class="math inline">\(S\)</span> (order up-to level). In <span class="math inline">\((S, R)\)</span> policy <span class="math inline">\(S\)</span> depend on <span class="math inline">\(R\)</span> given that to compute <span class="math inline">\(S\)</span> you need to compute <span class="math inline">\(S_s\)</span> (safety stocks) which depends on <span class="math inline">\(R\)</span> given <a href="#eq-ssSR" class="quarto-xref">Equation&nbsp;6</a>.</p>
<p><span id="eq-R"><span class="math display">\[
R = \frac{Q^{*}}{D} = \sqrt{\frac{2{k}}{hD}}
\tag{8}\]</span></span></p>
<p>Last equation <a href="#eq-R" class="quarto-xref">Equation&nbsp;8</a> was obtained with <a href="#eq-qstar" class="quarto-xref">Equation&nbsp;1</a>. Next step is compute <span class="math inline">\(Z_{\alpha}\)</span> (service factor) by computing the quantile function of an standardize normal distribution,<span class="math inline">\(\Phi^{-1}(\alpha)\)</span> (remember the relation of <a href="#eq-alpha" class="quarto-xref">Equation&nbsp;4</a>).</p>
<p><span class="math display">\[
Z_{\alpha} = \Phi^{-1}(\alpha)
\]</span></p>
<p>Then we compute <a href="#eq-ssSR" class="quarto-xref">Equation&nbsp;6</a>, shown below.</p>
<p><span class="math display">\[
S_{s} = Z_{\alpha}\sigma_{l_{d}} = Z_{\alpha} \sqrt{(\mu_{l} + R)\sigma_{d}^{2} + \sigma_{l}^{2}\mu_{d}^{2}}
\]</span></p>
<p>As a last step from this part we compute <span class="math inline">\(S\)</span>:</p>
<p><span class="math display">\[
S = d_{l} + d_{R} + S_{s} = \mu_{l}R + \mu_{d} + S_{s}
\]</span></p>
<p>All of this calculations are done in the code below.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Review period (years -&gt; days)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>k) <span class="sc">/</span> (params<span class="sc">$</span>h <span class="sc">*</span> params<span class="sc">$</span>d_yearly)) <span class="co"># years between orders</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>r_period <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">round</span>(<span class="dv">365</span> <span class="sc">*</span> R))                       <span class="co"># days between reviews (&gt;=1)</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Safety stock and S</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>z_alpha <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(params<span class="sc">$</span>alpha)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> z_alpha <span class="sc">*</span> <span class="fu">sqrt</span>((l_mu <span class="sc">+</span> r_period) <span class="sc">*</span> d_std<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> l_std<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> d_mu<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> (l_mu <span class="sc">+</span> r_period) <span class="sc">*</span> d_mu <span class="sc">+</span> ss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="initialize-vectors" class="level2">
<h2 class="anchored" data-anchor-id="initialize-vectors">3) Initialize vectors</h2>
<p>We are going to run a for-loop like the one that produced <a href="#fig-plot1" class="quarto-xref">Figure&nbsp;1</a> but much more complex. As describe we want to simulate the net inventory, shown in <a href="#eq-net" class="quarto-xref">Equation&nbsp;7</a>. But first let’s breaking down into parts and look at the code — it will make sense in the next section.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>n_days <span class="ot">&lt;-</span> t</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>max_lead_time <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(l_mu <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> l_std) <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># in_transit rows are calendar days; we only store arrival quantities</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>in_transit <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> n_days <span class="sc">+</span> max_lead_time, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(in_transit) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"quantity"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre-sample all daily demand</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">round</span>(<span class="fu">rnorm</span>(n_days, d_mu, d_std)))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Outputs of for-loop</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>on_hand <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>backorders <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>inventory_position <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)  <span class="co"># on-hand + on-order - backorders</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>orders <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>lead_times <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># initial state (before day 1)</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>on_hand_prev <span class="ot">&lt;-</span> S      <span class="co"># starting full to S</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>backorders_prev <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="a-word-about-in-transiton-order-inventory" class="level3">
<h3 class="anchored" data-anchor-id="a-word-about-in-transiton-order-inventory">A word about in-transit/on-order inventory</h3>
<p>In-transit inventory, for the purposes of this simulation, works as a calendar that will keep track how many days has been since an order was made. More formally it is a calendar-based matrix of future scheduled arrivals. This is what makes the model to have <em>memory</em> about the lead-time variability, <span class="math inline">\(\sigma_{l}\)</span>.</p>
</section>
</section>
<section id="for-loop-simulation" class="level2">
<h2 class="anchored" data-anchor-id="for-loop-simulation">4) For-loop simulation</h2>
<p>Let’s start with the <strong>friendly</strong> explication of the simulation:</p>
<p>Every loop is a day (<code>for (day in 1:n_days){}</code>). An inventory-day is divided in three:</p>
<ul>
<li><strong>Mornings</strong>:
<ul>
<li>In the morning we check whether there is any arrival from our suppliers <code>arrival_qty &lt;- in_transit[day, "quantity"]</code></li>
<li>Also we check if we have any back-order <code>backorders_prev &gt; 0</code>. If we do, <code>backorders_prev &gt; 0 = TRUE</code>, then that means we haven’t had any on-hand inventory, which means that the only way to fulfill a back-order is if there is any arrival from the in-transit suppliers <code>arrival_qty &gt; 0</code>. If <code>arrival_qty &gt; 0 = TRUE</code> then we check if the inventory is enough to fulfill all back-orders (the condition is <code>arrival_qty &gt;= backorders_prev</code>), if not then you just subtract the remaining back-orders with the previous ones. The code for all the morning part is down below.</li>
</ul></li>
</ul>
<div class="cell" data-execute="false">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (day <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_days) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrivals this morning</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  arrival_qty <span class="ot">&lt;-</span> in_transit[day, <span class="st">"quantity"</span>]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) allocate arrivals to existing bac-korders first</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (arrival_qty <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> backorders_prev <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (arrival_qty <span class="sc">&gt;=</span> backorders_prev) {</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>      arrival_remaining <span class="ot">&lt;-</span> arrival_qty <span class="sc">-</span> backorders_prev</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>      backorders_cur <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      on_hand_cur <span class="ot">&lt;-</span> on_hand_prev <span class="sc">+</span> arrival_remaining</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># arrival not enough to clear back-orders</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>      backorders_cur <span class="ot">&lt;-</span> backorders_prev <span class="sc">-</span> arrival_qty</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>      on_hand_cur <span class="ot">&lt;-</span> on_hand_prev  <span class="co"># usually 0 when back-orders exist</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no back-orders or no arrivals</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    backorders_cur <span class="ot">&lt;-</span> backorders_prev</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> on_hand_prev <span class="sc">+</span> arrival_qty</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;.... Next part, during the day</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>During the day.
<ul>
<li>We first ask us <em>“Can we satisfy the today’s demand given our on-hand inventory?</em> with the condition <code>on_hand_cur &gt;= d[day]</code>.</li>
</ul></li>
</ul>
<div class="cell" data-execute="false">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (on_hand_cur <span class="sc">&gt;=</span> d[day]) {</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> on_hand_cur <span class="sc">-</span> d[day]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># backorders_cur remains whatever it is (possibly 0)</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># demand exceeds on-hand -&gt; create backorders</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    backorders_cur <span class="ot">&lt;-</span> backorders_cur <span class="sc">+</span> (d[day] <span class="sc">-</span> on_hand_cur)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....Next part, end of the day</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Nights.
<ul>
<li>We keep track of in-transit inventory — aside from the daily routine, <code>on_hand_cur &gt;= d[day]</code> condition is a safeguard for the last day of the simulation. It prevents an error and ensures that once the model time-period is over, the model stops looking for future arrivals from the in-transit inventory.</li>
<li>Our Excel with all the daily data has to be updated with the <a href="#eq-net" class="quarto-xref">Equation&nbsp;7</a> (net-inventory is the same as <code>inventory_position</code>)</li>
<li>Finally we make a periodic review <span class="math inline">\(R\)</span> if it is review time, <code>day %% r_period == 0 = TRUE</code>. If the condition is <code>TRUE</code> we have check the order quantity, the lead-time our suppliers, and approximate the arrival day (trusting in the word our suppliers); we keep track of new order with our in-transit calendar.</li>
</ul></li>
</ul>
<div class="cell" data-execute="false">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (day <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_days) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) compute on-order (future arrivals) and inventory position</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (day <span class="sc">&lt;</span> <span class="fu">nrow</span>(in_transit)) {</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    total_in_transit <span class="ot">&lt;-</span> <span class="fu">sum</span>(in_transit[(day <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(in_transit), <span class="st">"quantity"</span>])</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    total_in_transit <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  inv_pos <span class="ot">&lt;-</span> on_hand_cur <span class="sc">+</span> total_in_transit <span class="sc">-</span> backorders_cur</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># save</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  on_hand[day] <span class="ot">&lt;-</span> on_hand_cur</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  backorders[day] <span class="ot">&lt;-</span> backorders_cur</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  inventory_position[day] <span class="ot">&lt;-</span> inv_pos</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4) periodic review: order up to S (inventory position used)</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (day <span class="sc">%%</span> r_period <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    l_time <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, l_mu, l_std)))</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    order_qty <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, S <span class="sc">-</span> inv_pos)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    arrival_day <span class="ot">&lt;-</span> day <span class="sc">+</span> l_time</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (arrival_day <span class="sc">&lt;=</span> <span class="fu">nrow</span>(in_transit)) {</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>      in_transit[arrival_day, <span class="st">"quantity"</span>] <span class="ot">&lt;-</span> in_transit[arrival_day, <span class="st">"quantity"</span>] <span class="sc">+</span> order_qty</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># arrival beyond simulation time period/horizon — ignore or extend in_transit</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Here we ignore</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    orders[day] <span class="ot">&lt;-</span> order_qty</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    lead_times[day] <span class="ot">&lt;-</span> l_time</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Day %3d REVIEW: inv_pos = %.1f, order = %.0f, lead = %d (arrive day %d)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>                day, inv_pos, order_qty, l_time, arrival_day))</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># update previous for next day</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>  on_hand_prev <span class="ot">&lt;-</span> on_hand_cur</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>  backorders_prev <span class="ot">&lt;-</span> backorders_cur</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Below the whole code:</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (day <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_days) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrivals this morning</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  arrival_qty <span class="ot">&lt;-</span> in_transit[day, <span class="st">"quantity"</span>]</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) allocate arrivals to existing backorders first</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (arrival_qty <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> backorders_prev <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (arrival_qty <span class="sc">&gt;=</span> backorders_prev) {</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>      arrival_remaining <span class="ot">&lt;-</span> arrival_qty <span class="sc">-</span> backorders_prev</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>      backorders_cur <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>      on_hand_cur <span class="ot">&lt;-</span> on_hand_prev <span class="sc">+</span> arrival_remaining</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># arrival not enough to clear backorders</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>      backorders_cur <span class="ot">&lt;-</span> backorders_prev <span class="sc">-</span> arrival_qty</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>      on_hand_cur <span class="ot">&lt;-</span> on_hand_prev  <span class="co"># usually 0 when backorders exist</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no outstanding backorders or no arrivals</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    backorders_cur <span class="ot">&lt;-</span> backorders_prev</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> on_hand_prev <span class="sc">+</span> arrival_qty</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) satisfy today's demand (d[day])</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (on_hand_cur <span class="sc">&gt;=</span> d[day]) {</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> on_hand_cur <span class="sc">-</span> d[day]</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># backorders_cur remains whatever it is (possibly 0)</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># demand exceeds on-hand -&gt; create backorders</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    backorders_cur <span class="ot">&lt;-</span> backorders_cur <span class="sc">+</span> (d[day] <span class="sc">-</span> on_hand_cur)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) compute on-order (future arrivals) and inventory position</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (day <span class="sc">&lt;</span> <span class="fu">nrow</span>(in_transit)) {</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    total_in_transit <span class="ot">&lt;-</span> <span class="fu">sum</span>(in_transit[(day <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(in_transit), <span class="st">"quantity"</span>])</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    total_in_transit <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>  inv_pos <span class="ot">&lt;-</span> on_hand_cur <span class="sc">+</span> total_in_transit <span class="sc">-</span> backorders_cur</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># save</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>  on_hand[day] <span class="ot">&lt;-</span> on_hand_cur</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>  backorders[day] <span class="ot">&lt;-</span> backorders_cur</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>  inventory_position[day] <span class="ot">&lt;-</span> inv_pos</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4) periodic review: order up to S (inventory position used)</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (day <span class="sc">%%</span> r_period <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>    l_time <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, l_mu, l_std)))</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>    order_qty <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, S <span class="sc">-</span> inv_pos)</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>    arrival_day <span class="ot">&lt;-</span> day <span class="sc">+</span> l_time</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (arrival_day <span class="sc">&lt;=</span> <span class="fu">nrow</span>(in_transit)) {</span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>      in_transit[arrival_day, <span class="st">"quantity"</span>] <span class="ot">&lt;-</span> in_transit[arrival_day, <span class="st">"quantity"</span>] <span class="sc">+</span> order_qty</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>      <span class="co"># arrival beyond simulation time period/horizon — ignore or extend in_transit</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Here we ignore</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>    orders[day] <span class="ot">&lt;-</span> order_qty</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>    lead_times[day] <span class="ot">&lt;-</span> l_time</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Day %3d REVIEW: inv_pos = %.1f, order = %.0f, lead = %d (arrive day %d)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>                day, inv_pos, order_qty, l_time, arrival_day))</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># update previous for next day</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>  on_hand_prev <span class="ot">&lt;-</span> on_hand_cur</span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>  backorders_prev <span class="ot">&lt;-</span> backorders_cur</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Day  38 REVIEW: inv_pos = 1457.2, order = 3056, lead = 2 (arrive day 40)
Day  76 REVIEW: inv_pos = 786.2, order = 3727, lead = 4 (arrive day 80)
Day 114 REVIEW: inv_pos = 898.2, order = 3615, lead = 4 (arrive day 118)
Day 152 REVIEW: inv_pos = 953.2, order = 3560, lead = 4 (arrive day 156)
Day 190 REVIEW: inv_pos = 454.2, order = 4059, lead = 5 (arrive day 195)
Day 228 REVIEW: inv_pos = 735.2, order = 3778, lead = 3 (arrive day 231)
Day 266 REVIEW: inv_pos = 566.2, order = 3947, lead = 6 (arrive day 272)
Day 304 REVIEW: inv_pos = 849.2, order = 3664, lead = 2 (arrive day 306)
Day 342 REVIEW: inv_pos = 705.2, order = 3808, lead = 4 (arrive day 346)</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We compute a tibble data frame for a plot</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">days =</span> <span class="dv">1</span><span class="sc">:</span>n_days,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">on_hand =</span> on_hand,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">backorders =</span> backorders,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">inventory_position =</span> inventory_position,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">demand =</span> d,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_qty =</span> orders</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 6
    days on_hand backorders inventory_position demand order_qty
   &lt;int&gt;   &lt;dbl&gt;      &lt;dbl&gt;              &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
 1     1   4298.          0              5243.    110         0
 2     2   4200.          0              5145.     98         0
 3     3   4109.          0              5054.     91         0
 4     4   3991.          0              4936.    118         0
 5     5   3901.          0              4846.     90         0
 6     6   3845.          0              4790.     56         0
 7     7   3756.          0              4701.     89         0
 8     8   3637.          0              4582.    119         0
 9     9   3510.          0              4455.    127         0
10    10   3415.          0              4360.     95         0
# ℹ 355 more rows</code></pre>
</div>
</div>
<p>PLOT!!!!!!</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>results<span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days)) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> on_hand), <span class="at">colour =</span> <span class="st">"#1E90FF"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> backorders), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Stochastic simulation of a (R, S) policy"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"With alpha = 0.95"</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="dv">0</span>, n_days, r_period), </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, n_days, r_period), <span class="at">y =</span> s <span class="sc">+</span> <span class="dv">1</span>, </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Reorder"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-plot6-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: 1st Simulation:In red is the back-orders and in blue the on-hand inventory
</figcaption>
</figure>
</div>
</div>
</div>
<section id="learning-by-playing" class="level3">
<h3 class="anchored" data-anchor-id="learning-by-playing">Learning by playing</h3>
<p>Let’s simulate again everything but changing <span class="math inline">\(\alpha\)</span> to 50% and increase the variability of the lead-time <span class="math inline">\(\sigma^{2}_{l}\)</span> to 15.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Define Lead time and </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)         <span class="co"># For reproducibility</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">365</span>               <span class="co"># days</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>d_mu <span class="ot">&lt;-</span> <span class="dv">100</span>; l_mu <span class="ot">=</span> <span class="dv">4</span>  <span class="co"># daily demand [units/day]</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>d_std <span class="ot">&lt;-</span> <span class="dv">25</span>; l_std <span class="ot">=</span> <span class="dv">15</span> <span class="co"># daily lead time </span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters:</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>params2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">100</span>, <span class="co"># fixed cost of a single transaction [$/order] </span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fl">0.5</span>, <span class="co"># yearly holding costs for keeping one single piece in stock [$/unit * year]</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_yearly =</span> <span class="dv">365</span> <span class="sc">*</span> d_mu, <span class="co"># yearly expected demand</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.50</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Review period (years -&gt; days)</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="dv">2</span> <span class="sc">*</span> params2<span class="sc">$</span>k) <span class="sc">/</span> (params2<span class="sc">$</span>h <span class="sc">*</span> params2<span class="sc">$</span>d_yearly))      <span class="co"># years between orders</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>r_period <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">round</span>(<span class="dv">365</span> <span class="sc">*</span> R))                            <span class="co"># days between reviews (&gt;=1)</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Safety stock and S</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>z_alpha <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(params2<span class="sc">$</span>alpha)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> z_alpha <span class="sc">*</span> <span class="fu">sqrt</span>((l_mu <span class="sc">+</span> r_period) <span class="sc">*</span> d_std<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> l_std<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> d_mu<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> (l_mu <span class="sc">+</span> r_period) <span class="sc">*</span> d_mu <span class="sc">+</span> ss</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>n_days <span class="ot">&lt;-</span> t</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>max_lead_time <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(l_mu <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> l_std) <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="co"># in_transit rows are calendar days; we only store arrival quantities</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>in_transit <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> n_days <span class="sc">+</span> max_lead_time, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(in_transit) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"quantity"</span>)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre-sample all daily demand</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">round</span>(<span class="fu">rnorm</span>(n_days, d_mu, d_std)))</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Outputs</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>on_hand <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>backorders <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>inventory_position <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)  <span class="co"># on-hand + on-order - backorders</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>orders <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>lead_times <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="co"># initial state (before day 1)</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>on_hand_prev <span class="ot">&lt;-</span> S      <span class="co"># starting full to S</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>backorders_prev <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (day <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_days) {</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrivals this morning</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>  arrival_qty <span class="ot">&lt;-</span> in_transit[day, <span class="st">"quantity"</span>]</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) allocate arrivals to existing backorders first</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (arrival_qty <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> backorders_prev <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (arrival_qty <span class="sc">&gt;=</span> backorders_prev) {</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>      arrival_remaining <span class="ot">&lt;-</span> arrival_qty <span class="sc">-</span> backorders_prev</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>      backorders_cur <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>      on_hand_cur <span class="ot">&lt;-</span> on_hand_prev <span class="sc">+</span> arrival_remaining</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>      <span class="co"># arrival not enough to clear backorders</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>      backorders_cur <span class="ot">&lt;-</span> backorders_prev <span class="sc">-</span> arrival_qty</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>      on_hand_cur <span class="ot">&lt;-</span> on_hand_prev  <span class="co"># usually 0 when backorders exist</span></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no outstanding backorders or no arrivals</span></span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>    backorders_cur <span class="ot">&lt;-</span> backorders_prev</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> on_hand_prev <span class="sc">+</span> arrival_qty</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) satisfy today's demand (d[day])</span></span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (on_hand_cur <span class="sc">&gt;=</span> d[day]) {</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> on_hand_cur <span class="sc">-</span> d[day]</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># backorders_cur remains whatever it is (possibly 0)</span></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># demand exceeds on-hand -&gt; create backorders</span></span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>    backorders_cur <span class="ot">&lt;-</span> backorders_cur <span class="sc">+</span> (d[day] <span class="sc">-</span> on_hand_cur)</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) compute on-order (future arrivals) and inventory position</span></span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (day <span class="sc">&lt;</span> <span class="fu">nrow</span>(in_transit)) {</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>    total_in_transit <span class="ot">&lt;-</span> <span class="fu">sum</span>(in_transit[(day <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(in_transit), <span class="st">"quantity"</span>])</span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>    total_in_transit <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>  inv_pos <span class="ot">&lt;-</span> on_hand_cur <span class="sc">+</span> total_in_transit <span class="sc">-</span> backorders_cur</span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># save</span></span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>  on_hand[day] <span class="ot">&lt;-</span> on_hand_cur</span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>  backorders[day] <span class="ot">&lt;-</span> backorders_cur</span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a>  inventory_position[day] <span class="ot">&lt;-</span> inv_pos</span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4) periodic review: order up to S (inventory position used)</span></span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (day <span class="sc">%%</span> r_period <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a>    l_time <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, l_mu, l_std)))</span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a>    order_qty <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, S <span class="sc">-</span> inv_pos)</span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a>    arrival_day <span class="ot">&lt;-</span> day <span class="sc">+</span> l_time</span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (arrival_day <span class="sc">&lt;=</span> <span class="fu">nrow</span>(in_transit)) {</span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>      in_transit[arrival_day, <span class="st">"quantity"</span>] <span class="ot">&lt;-</span> in_transit[arrival_day, <span class="st">"quantity"</span>] <span class="sc">+</span> order_qty</span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a>      <span class="co"># arrival beyond simulation time period/horizon — ignore or extend in_transit</span></span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Here we ignore</span></span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>    orders[day] <span class="ot">&lt;-</span> order_qty</span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>    lead_times[day] <span class="ot">&lt;-</span> l_time</span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cat(sprintf("Day %3d REVIEW: inv_pos = %.1f, order = %.0f, lead = %d (arrive day %d)\n",</span></span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>    <span class="co">#            day, inv_pos, order_qty, l_time, arrival_day))</span></span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a>  <span class="co"># update previous for next day</span></span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a>  on_hand_prev <span class="ot">&lt;-</span> on_hand_cur</span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a>  backorders_prev <span class="ot">&lt;-</span> backorders_cur</span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a>results_2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">days =</span> <span class="dv">1</span><span class="sc">:</span>n_days,</span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">on_hand =</span> on_hand,</span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">backorders =</span> backorders,</span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">inventory_position =</span> inventory_position,</span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">demand =</span> d,</span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_qty =</span> orders</span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a>results_2<span class="sc">|&gt;</span> </span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days)) <span class="sc">+</span></span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> on_hand), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> backorders), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Stochastic simulation of a (R, S) policy"</span>,</span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"With alpha = 0.50"</span> </span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="dv">0</span>, n_days, r_period), </span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, n_days, r_period), <span class="at">y =</span> s <span class="sc">+</span> <span class="dv">1</span>, </span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Reorder"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot7" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-plot7-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: 2ng Simulation: In red is the back-orders and in blue the on-hand inventory. Notice how much redish
</figcaption>
</figure>
</div>
</div>
</div>
<p>Wow, compare <a href="#fig-plot6" class="quarto-xref">Figure&nbsp;8</a> with <a href="#fig-plot7" class="quarto-xref">Figure&nbsp;9</a>. Changing <span class="math inline">\(\alpha\)</span> &amp; <span class="math inline">\(\sigma^{2}_{l}\)</span> really makes the inventory more insecure. I suggest changing the hyperparameters of demand and lead-time, you will see big changes in the behavior of the simulation; at the same time change <span class="math inline">\(\alpha\)</span>, you will notice that while increasing the variability of the model, keeping an <span class="math inline">\(\alpha\)</span> above 90% will really keep your inventory mostly safe.</p>
</section>
</section>
<section id="sad-reality" class="level2">
<h2 class="anchored" data-anchor-id="sad-reality">Sad reality</h2>
<p>There’s something sad around this last simulation. It also has assumptions that hurts its accuracy. Assumptions:</p>
<ul>
<li>Normality. Demand nor lead-time aren’t normal. They are discrete variables.</li>
<li>Independence. We are assuming that demand and lead-time are independent of each other, this can be untrue, we have to check their correlation.</li>
<li>Stationary. Demand has high autocorrelation, therefore it does not behave like in <a href="#fig-plot8" class="quarto-xref">Figure&nbsp;10</a>.</li>
<li>Different orders can cross each other.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>plot8 <span class="ot">&lt;-</span> results <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days, <span class="at">y =</span> demand)) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"firebrick1"</span>) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Demand"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Stationarity demand is behaving"</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plot8</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot8" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-plot8-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: This kind of behavior isn’t real. There is high autocorrelation.
</figcaption>
</figure>
</div>
</div>
</div>
<p>All of these makes the stochastic model with room for improvement — but not today.</p>
</section>
</section>
<section id="reflection" class="level1">
<h1>Reflection</h1>
<p>Making an inventory simulation isn’t as easy as someone would had think. Complex supply chains demand us making adjustments to old models, like EOQ model where <a href="#eq-qstar" class="quarto-xref">Equation&nbsp;1</a> was derived. This seems to be part of an ever changing world that after the Renascence the rate of change has increased dramatically. However, this old simplistic models do help us makes sense the phenomena we are trying to understand; and this can be applied to all models, not even mathematical ones, at the end we live in a world we don’t understand.</p>
<section id="p.d." class="level2">
<h2 class="anchored" data-anchor-id="p.d.">P.D.</h2>
<p>I thought this article would take me 2 days to finish. It took me 5. I am quite exhausted. I just love doing some math, and trying to make sense of the world and do crazy stuff. Anyone who came all the way to here, I hope you liked it; I know math can be hard, but it really is useful, and congrats if you made the effort, go right now to celebrate with your love ones. Cheers.</p>


<!-- -->


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-taleb2007" class="csl-entry" role="listitem">
Taleb, Nassim Nicholas. 2007. <em>The Black Swan: The Impact of the Highly Improbable</em>. 2nd, Updated. New York: Random House.
</div>
<div id="ref-vandeput2020" class="csl-entry" role="listitem">
Vandeput, Nicolas. 2020. <em>Inventory Optimization: Models and Simulations</em>. De Gruyter.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb24" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Stochastic Inventory Modelling: A Tutorial for Dummies using R"</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">    # Code styling</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show code"</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">    css: styles.css</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2025-09-09</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="an">code-block-bg:</span><span class="co"> true</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="an">code-block-border-left:</span><span class="co"> "#31BAE9"</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true       # Show code </span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false   # Hide warnings</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false   # Hide messages</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co">  results: true    # Show results (output)</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co">  output: true     # Show output</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>Strangely enough, two years ago I was wandering in the college library thinking *"what do quality engineers do?"*; in my mind it's common for me to be wondering that given the nature of my undergraduate degree (biotech engineer). Reading about it I stumbled with terms like Lean Six Sigma, DMAIC, SKUs, KPIs, etc..., but I wasn't compelled because I read a word that made me turn my stomach. ***Gurus***. I couldn't handle that word at the time. *"How can a serious book for engineers follow someone known as a guru"* I thought. I wouldn't have imagined that 2 years from that moment I would be digging into philosophies from these gurus --- being Juran's my favorite.</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>A big part of quality is **Inventory management**, and that's the topic for my second blog. This is the objective: teach you how to make a simulation of a beer business model for its inventory management using **R + tidyverse**. You cannot be vague nor lie to a computer; so if you program it, you know it.</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>This blog is heavily influenced by @vandeput2020 fantastic book about inventory optimization --- I am half through it. If you want get into inventory theory I fully recommend this book, he really explains it phenomenally.</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>We will be using the next packages:</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Packages</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># for data manipulation, plotting, etc...</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)        <span class="co"># for better tables</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)    <span class="co"># for graphs</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a><span class="fu"># Beer business</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>Beer companies have five principal raw materials that they have to order from their suppliers: malt, hops, yeast, bottles, and caps. But:</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When should they order?</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How much should they order?</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a><span class="fu">## Where should I order?</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>This question is also key in inventory management but it is out of the scope of this article.</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>These are the questions to ask for their inventory management; if they do not handle it well they will have dead stock, and bad service for their clients. But how can they answer them? There are three variables to keep in mind:</span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **costs** of the raw materials, $c$</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **demand** of the customers, $d$</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **lead time** for the materials to arrive at the warehouse, $L$</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>The model we will be building is to optimize for these three variables and answer those questions. In order to make a model we have to get some straight rules about the beer business we are simulating, which we will call Dr.House Brewer, we need an **Inventory Policy**, otherwise it will be hell to model it. Always some order is a good thing for companies.</span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a><span class="fu">## Inventory policy: Periodic Review &amp; Order Up-to Level (R, S)</span></span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>While there are many policies, Dr.House Brewer has a very popperian philosophy and does not trust new innovative policies that promise to increase its ROI by 100%, NO, the company adopts the common *Periodic Review &amp; Order Up-to Level* policy. If you go to Walmart on a specific day of the week to stock up on groceries, you are following Periodic Review &amp; Order Up-to Level policy. It consists of a periodic time interval (say every 5 workdays), $R$, when you reorder all your inventory with your suppliers (fixed schedule) and an **up-to level reorder point**, $S$ (you always want to have 10 eggs, you have right now 2, you wait until it is Monday (your reorder time, $R$) to buy your 8 eggs; 10 eggs is your **up-to level reorder point**, $S$). This policy is usually written as $(R,S)$, $R$ for review period and $S$ for up-to level reorder point.</span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simulation time: (R, S) policy in R</span></span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>We will assume two things:</span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **demand** of the customers, $d$, is constant/fixed</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **lead time** for the materials to arrive at the warehouse, $l$, does NOT exist</span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>These are strong assumptions that are going to be a key point latter in this blog. Let's think of $l$; if there is no lead time, $l = 0$, the moment it is your reorder time, $R$, is the moment you get it. This is never the case, but we are going to assume it for the moment.</span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a>We need to define the demand, $d$, the time period (in this daily case), $R$ and $S$, so...,</span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: (R, S) policy-simulation-1</span></span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters:</span></span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>s        <span class="ot">&lt;-</span> <span class="dv">14</span>  <span class="co"># order-up-to level (14 units)</span></span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a>r_period <span class="ot">&lt;-</span> <span class="dv">5</span>   <span class="co"># review period (every 5 days)</span></span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>demand   <span class="ot">&lt;-</span> <span class="dv">2</span>   <span class="co"># constant daily demand</span></span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a>n_days   <span class="ot">&lt;-</span> <span class="dv">24</span>  <span class="co"># number of days to simulate</span></span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors for the simulation</span></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>days         <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n_days</span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a>inventory    <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)  <span class="co"># the storage of the data</span></span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a>inventory[<span class="dv">1</span>] <span class="ot">&lt;-</span> s                <span class="co"># Start with order-up-to level</span></span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a>Fantastic, we want a plot of how inventory changes over time using the (R, S) policy, so it will be our dependent variable. I'll show you the code, try to understand it, then I'll explain the logic behind it:</span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: (R, S) policy-simulation-2</span></span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_days) {</span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((i <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%%</span> r_period <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> i <span class="sc">&gt;</span> <span class="dv">1</span>) { <span class="co"># "%%"-&gt; modulus operation so if 7 %% 3 = 1</span></span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replenish to order-up-to level, s:</span></span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a>    inventory[i] <span class="ot">&lt;-</span> s                 </span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Carry forward previous day's ending inventory:</span></span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a>    inventory[i] <span class="ot">&lt;-</span> inventory[i <span class="sc">-</span> <span class="dv">1</span>]  </span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Consume demand at end of the day:</span></span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a>  inventory[i] <span class="ot">&lt;-</span> inventory[i] <span class="sc">-</span> demand</span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print it</span></span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Day"</span>, i, <span class="st">": Inventory after demand ="</span>, inventory[i], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a>**Logic:** our inventory array will be decreasing per day given the constant demand, but given that we have a periodic review, $R$, the moment it is $R$-day the moment it replenishes your inventory (remember we won't be waiting any time between order and the supplies arriving at the warehouse, there is no **lead time**) to an up-to level reorder point, $S$. We need a for-loop that will help us evaluate whether the inventory per *i* day. A day is composed of mornings and evenings; in the morning we evaluate whether it is $R$-day or not, this is what the first condition does <span class="in">`(i - 1) %% r_period`</span>; inside the loop:</span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Day     <span class="pp">|</span> Evaluation       <span class="pp">|</span> Result  <span class="pp">|</span> Note                                 <span class="pp">|</span></span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a><span class="pp">|---------|------------------|---------|--------------------------------------|</span></span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`i = 1`</span> <span class="pp">|</span> <span class="in">`(1-1) %% 5`</span> = 0 <span class="pp">|</span> <span class="in">`False`</span> <span class="pp">|</span> but we exclude day 1 with <span class="in">`&amp;&amp; i &gt; 1`</span> <span class="pp">|</span></span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`i = 2`</span> <span class="pp">|</span> <span class="in">`(2-1) %% 5`</span> = 1 <span class="pp">|</span> <span class="in">`False`</span> <span class="pp">|</span> <span class="sc">\-</span>                                   <span class="pp">|</span></span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`i = 3`</span> <span class="pp">|</span> <span class="in">`(3-1) %% 5`</span> = 2 <span class="pp">|</span> <span class="in">`False`</span> <span class="pp">|</span> <span class="sc">\-</span>                                   <span class="pp">|</span></span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`.....`</span> <span class="pp">|</span> <span class="in">`.....`</span>          <span class="pp">|</span> <span class="in">`.....`</span> <span class="pp">|</span> <span class="in">`.....`</span>                              <span class="pp">|</span></span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`i = 6`</span> <span class="pp">|</span> <span class="in">`(6-1) %% 5`</span> = 0 <span class="pp">|</span> <span class="in">`True`</span>  <span class="pp">|</span> equal to 0                           <span class="pp">|</span></span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a>The next conditional, <span class="in">`else if (i &gt; 1)`</span> , is just saying *"Is this NOT the first day AND NOT a review day? If YES, start with yesterday's leftover inventory"*. Then by the end of the day we have <span class="in">`inventory[i] - demand`</span> inventory.</span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-132"><a href="#cb24-132" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb24-133"><a href="#cb24-133" aria-hidden="true" tabindex="-1"></a>You can make this for-loop a function with <span class="in">`simulate_inventory &lt;- function(s, r_period, demand, n_days)`</span> as parameters, if you want.</span>
<span id="cb24-134"><a href="#cb24-134" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-135"><a href="#cb24-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-138"><a href="#cb24-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-139"><a href="#cb24-139" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot1</span></span>
<span id="cb24-140"><a href="#cb24-140" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "(R,S) simulation. Note how it never gets S = 14 [units]; because the simulation gives the inventory AFTER the review, or at the end of the day. So after R-day next day in the morning you have 14 but you will be consuming 2, given the daily demand, which makes it 12 [units] in the inventory"</span></span>
<span id="cb24-141"><a href="#cb24-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-142"><a href="#cb24-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tidy data fram, called tibble</span></span>
<span id="cb24-143"><a href="#cb24-143" aria-hidden="true" tabindex="-1"></a>inventory_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb24-144"><a href="#cb24-144" aria-hidden="true" tabindex="-1"></a>  <span class="at">days =</span> days,</span>
<span id="cb24-145"><a href="#cb24-145" aria-hidden="true" tabindex="-1"></a>  <span class="at">inventory =</span> inventory</span>
<span id="cb24-146"><a href="#cb24-146" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-147"><a href="#cb24-147" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the inventory over time</span></span>
<span id="cb24-148"><a href="#cb24-148" aria-hidden="true" tabindex="-1"></a>plot_1 <span class="ot">&lt;-</span> inventory_data <span class="sc">|&gt;</span> </span>
<span id="cb24-149"><a href="#cb24-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(days, inventory)) <span class="sc">+</span></span>
<span id="cb24-150"><a href="#cb24-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb24-151"><a href="#cb24-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb24-152"><a href="#cb24-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-153"><a href="#cb24-153" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Inventory Levels Over Time"</span>,</span>
<span id="cb24-154"><a href="#cb24-154" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"(R,S) Policy: Review every"</span>, r_period, <span class="st">"days, Order up to"</span>, s, <span class="st">"units"</span>),</span>
<span id="cb24-155"><a href="#cb24-155" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Days"</span>,</span>
<span id="cb24-156"><a href="#cb24-156" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Inventory Level"</span></span>
<span id="cb24-157"><a href="#cb24-157" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-158"><a href="#cb24-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, n_days, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb24-159"><a href="#cb24-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-160"><a href="#cb24-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="dv">5</span>, n_days, r_period), </span>
<span id="cb24-161"><a href="#cb24-161" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb24-162"><a href="#cb24-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">5</span>, n_days, r_period), <span class="at">y =</span> s <span class="sc">+</span> <span class="dv">1</span>, </span>
<span id="cb24-163"><a href="#cb24-163" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Reorder"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>)</span>
<span id="cb24-164"><a href="#cb24-164" aria-hidden="true" tabindex="-1"></a>plot_1 </span>
<span id="cb24-165"><a href="#cb24-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-166"><a href="#cb24-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-167"><a href="#cb24-167" aria-hidden="true" tabindex="-1"></a>@fig-plot1 shows the plot of inventory vs time. Note how the assumptions affect the simulation: there is an instantaneous replenishment of the inventory level and the inventory level is decreasing uniformly (just a straight line) given constant daily demand. This policy does not show fluctuations in time, but it can be risky because you can get into red levels of inventory level given an unexpected increase in demand and being far from $R$-day (or any given time-period).</span>
<span id="cb24-168"><a href="#cb24-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-169"><a href="#cb24-169" aria-hidden="true" tabindex="-1"></a>Dr.House Brewer has chosen its policy, how can it be optimized?</span>
<span id="cb24-170"><a href="#cb24-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-171"><a href="#cb24-171" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb24-172"><a href="#cb24-172" aria-hidden="true" tabindex="-1"></a>**Inventory Level** is the net inventory: available on-hand inventory and in-transit inventory, minus back-orders, orders not yet shipped, etc.</span>
<span id="cb24-173"><a href="#cb24-173" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-174"><a href="#cb24-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-175"><a href="#cb24-175" aria-hidden="true" tabindex="-1"></a><span class="fu"># Supply chains &amp; Inventories</span></span>
<span id="cb24-176"><a href="#cb24-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-177"><a href="#cb24-177" aria-hidden="true" tabindex="-1"></a>There are three topics to keep in mind in the supply chain: suppliers, warehouse, and customers (@fig-plot2). The important question for us, the inventory managers at Dr.House Brewery warehouse, is to ask: <span class="sc">\*\*\_</span> How much should I order?<span class="sc">\_\*\*</span>. We have a policy, but how can we plan it? It turns out this isn't an easy question to answer, because as the population increases, so do the customers, the suppliers and the warehouses, and big companies have it tough. That's why we need a model that can help us navigate this complex supply chains.</span>
<span id="cb24-178"><a href="#cb24-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-181"><a href="#cb24-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-182"><a href="#cb24-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot2</span></span>
<span id="cb24-183"><a href="#cb24-183" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Typical supply chain. Keep in mind there can be n suppliers, warehouses, and customers"</span></span>
<span id="cb24-184"><a href="#cb24-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-185"><a href="#cb24-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-186"><a href="#cb24-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-187"><a href="#cb24-187" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">make_graph</span>(<span class="sc">~</span><span class="st">"Suppliers"</span><span class="sc">-+</span><span class="st">"Warehouse"</span>, </span>
<span id="cb24-188"><a href="#cb24-188" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Warehouse"</span><span class="sc">-+</span><span class="st">"Customers"</span>) <span class="co"># - means line &amp; + means arrow</span></span>
<span id="cb24-189"><a href="#cb24-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-190"><a href="#cb24-190" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g1, </span>
<span id="cb24-191"><a href="#cb24-191" aria-hidden="true" tabindex="-1"></a>     <span class="at">layout =</span> <span class="fu">layout_as_tree</span>(g1),</span>
<span id="cb24-192"><a href="#cb24-192" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.color =</span> <span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"red"</span>),</span>
<span id="cb24-193"><a href="#cb24-193" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.size =</span> <span class="dv">35</span>,</span>
<span id="cb24-194"><a href="#cb24-194" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.arrow.size =</span> <span class="fl">0.8</span>,</span>
<span id="cb24-195"><a href="#cb24-195" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.cex =</span> <span class="fl">1.2</span>)</span>
<span id="cb24-196"><a href="#cb24-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-197"><a href="#cb24-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-198"><a href="#cb24-198" aria-hidden="true" tabindex="-1"></a><span class="fu">## Economic Order Quantity (EOQ) model</span></span>
<span id="cb24-199"><a href="#cb24-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-200"><a href="#cb24-200" aria-hidden="true" tabindex="-1"></a>*How much should I order?* turned out to be depending on the costs!!! --- it is always about money.</span>
<span id="cb24-201"><a href="#cb24-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-202"><a href="#cb24-202" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-203"><a href="#cb24-203" aria-hidden="true" tabindex="-1"></a>C(Q)</span>
<span id="cb24-204"><a href="#cb24-204" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-205"><a href="#cb24-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-206"><a href="#cb24-206" aria-hidden="true" tabindex="-1"></a>Where $C$ is cost, and $Q$ is order quantity. There is two types of costs:</span>
<span id="cb24-207"><a href="#cb24-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-208"><a href="#cb24-208" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Holding costs**. Costs associated with storing products. Two types:</span>
<span id="cb24-209"><a href="#cb24-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-210"><a href="#cb24-210" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Variable holding costs** (e.g. losses)</span>
<span id="cb24-211"><a href="#cb24-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-212"><a href="#cb24-212" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Fixed holding costs** (e.g. employees)</span>
<span id="cb24-213"><a href="#cb24-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-214"><a href="#cb24-214" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Transaction Costs**. All costs associated with ordering the product from the suppliers. Not only transportation. Two types:</span>
<span id="cb24-215"><a href="#cb24-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-216"><a href="#cb24-216" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Variable transaction costs** (e.g. packaging)</span>
<span id="cb24-217"><a href="#cb24-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-218"><a href="#cb24-218" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Fixed transaction costs** (e.g. fixed fees)</span>
<span id="cb24-219"><a href="#cb24-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-220"><a href="#cb24-220" aria-hidden="true" tabindex="-1"></a>We won't be caring for **Variable transaction costs** because they do not depend on $Q$ (they depend on the demand, $d$). This is the equation:</span>
<span id="cb24-221"><a href="#cb24-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-222"><a href="#cb24-222" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-223"><a href="#cb24-223" aria-hidden="true" tabindex="-1"></a>Total Costs = Holding Costs + Transaction Costs</span>
<span id="cb24-224"><a href="#cb24-224" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-225"><a href="#cb24-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-226"><a href="#cb24-226" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-227"><a href="#cb24-227" aria-hidden="true" tabindex="-1"></a>\longrightarrow C(Q) = h \frac {Q}{2} + k \frac{D}{Q}</span>
<span id="cb24-228"><a href="#cb24-228" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-229"><a href="#cb24-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-230"><a href="#cb24-230" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb24-231"><a href="#cb24-231" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dimensional Analysis for the engineers out there:</span></span>
<span id="cb24-232"><a href="#cb24-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-233"><a href="#cb24-233" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-234"><a href="#cb24-234" aria-hidden="true" tabindex="-1"></a>C(Q) = \left( \frac {<span class="co">[</span><span class="ot">currency</span><span class="co">]</span>} {<span class="co">[</span><span class="ot">unit</span><span class="co">]</span>  <span class="co">[</span><span class="ot">time</span><span class="co">]</span>} * \frac {<span class="co">[</span><span class="ot">item</span><span class="co">]</span>}{1} \right) +  \left( \frac{<span class="co">[</span><span class="ot">currency</span><span class="co">]</span>}{<span class="co">[</span><span class="ot">order</span><span class="co">]</span>} * \frac {<span class="co">[</span><span class="ot">unit</span><span class="co">]</span>}{<span class="co">[</span><span class="ot">time</span><span class="co">]</span>} * \frac{1}{<span class="co">[</span><span class="ot">unit</span><span class="co">]</span>}      \right)</span>
<span id="cb24-235"><a href="#cb24-235" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-236"><a href="#cb24-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-237"><a href="#cb24-237" aria-hidden="true" tabindex="-1"></a>Since $<span class="co">[</span><span class="ot">order</span><span class="co">]</span>$ is a count, it is often considered dimensionally defined as equivalent to a pure number, dimensionless.</span>
<span id="cb24-238"><a href="#cb24-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-239"><a href="#cb24-239" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-240"><a href="#cb24-240" aria-hidden="true" tabindex="-1"></a>C(Q) = \left( \frac {<span class="co">[</span><span class="ot">currency</span><span class="co">]</span>} {<span class="co">[</span><span class="ot">unit</span><span class="co">]</span>  <span class="co">[</span><span class="ot">time</span><span class="co">]</span>} * \frac {<span class="co">[</span><span class="ot">item</span><span class="co">]</span>}{1} \right) +  \left( \frac{<span class="co">[</span><span class="ot">currency</span><span class="co">]</span>}{1} * \frac {<span class="co">[</span><span class="ot">unit</span><span class="co">]</span>}{<span class="co">[</span><span class="ot">time</span><span class="co">]</span>} * \frac{1}{<span class="co">[</span><span class="ot">unit</span><span class="co">]</span>}      \right)</span>
<span id="cb24-241"><a href="#cb24-241" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-242"><a href="#cb24-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-243"><a href="#cb24-243" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-244"><a href="#cb24-244" aria-hidden="true" tabindex="-1"></a>= \frac{<span class="co">[</span><span class="ot">currency</span><span class="co">]</span> }{<span class="co">[</span><span class="ot">time</span><span class="co">]</span>}  +  \frac{<span class="co">[</span><span class="ot">currency</span><span class="co">]</span> }{<span class="co">[</span><span class="ot">time</span><span class="co">]</span>}  = \frac{<span class="co">[</span><span class="ot">currency</span><span class="co">]</span> }{<span class="co">[</span><span class="ot">time</span><span class="co">]</span>} </span>
<span id="cb24-245"><a href="#cb24-245" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-246"><a href="#cb24-246" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-247"><a href="#cb24-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-248"><a href="#cb24-248" aria-hidden="true" tabindex="-1"></a><span class="fu">### What does it all mean? </span></span>
<span id="cb24-249"><a href="#cb24-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-250"><a href="#cb24-250" aria-hidden="true" tabindex="-1"></a>I won't be focusing on the code, for the moment (it is relatively easy this chunk of code), because it isn't really important. What is important is understanding the EOQ equation ($C(Q)$). So let's focus on the plots:</span>
<span id="cb24-251"><a href="#cb24-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-254"><a href="#cb24-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-255"><a href="#cb24-255" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plots</span></span>
<span id="cb24-256"><a href="#cb24-256" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "EOQ model"</span></span>
<span id="cb24-257"><a href="#cb24-257" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb24-258"><a href="#cb24-258" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Propotionality"</span></span>
<span id="cb24-259"><a href="#cb24-259" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Inversely proporsional" </span></span>
<span id="cb24-260"><a href="#cb24-260" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Combine variables"</span></span>
<span id="cb24-261"><a href="#cb24-261" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout: [[45,-10, 45], [100]]</span></span>
<span id="cb24-262"><a href="#cb24-262" aria-hidden="true" tabindex="-1"></a><span class="co"># EOQ: total cost = holding costs + transactions costs</span></span>
<span id="cb24-263"><a href="#cb24-263" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb24-264"><a href="#cb24-264" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fl">0.5</span> </span>
<span id="cb24-265"><a href="#cb24-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-266"><a href="#cb24-266" aria-hidden="true" tabindex="-1"></a>eoc_m <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb24-267"><a href="#cb24-267" aria-hidden="true" tabindex="-1"></a>    <span class="at">q =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="fl">0.1</span>),         <span class="co"># Order quantity</span></span>
<span id="cb24-268"><a href="#cb24-268" aria-hidden="true" tabindex="-1"></a>    <span class="at">h_cost =</span> (h) <span class="sc">*</span> (q<span class="sc">/</span><span class="dv">2</span>),        <span class="co"># Holding cost</span></span>
<span id="cb24-269"><a href="#cb24-269" aria-hidden="true" tabindex="-1"></a>    <span class="at">t_cost =</span> k <span class="sc">*</span> (demand<span class="sc">/</span>q),     <span class="co"># Transaction cost</span></span>
<span id="cb24-270"><a href="#cb24-270" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_cost =</span> h_cost <span class="sc">+</span> t_cost <span class="co"># Total costs</span></span>
<span id="cb24-271"><a href="#cb24-271" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb24-272"><a href="#cb24-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-273"><a href="#cb24-273" aria-hidden="true" tabindex="-1"></a>plot_2 <span class="ot">&lt;-</span> eoc_m <span class="sc">|&gt;</span> </span>
<span id="cb24-274"><a href="#cb24-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(q, h_cost)) <span class="sc">+</span></span>
<span id="cb24-275"><a href="#cb24-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"darkorange"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb24-276"><a href="#cb24-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-277"><a href="#cb24-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-278"><a href="#cb24-278" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Holding cost: (h) * (q/2)"</span>,</span>
<span id="cb24-279"><a href="#cb24-279" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Cost"</span>,</span>
<span id="cb24-280"><a href="#cb24-280" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Order quantity"</span></span>
<span id="cb24-281"><a href="#cb24-281" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-282"><a href="#cb24-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-283"><a href="#cb24-283" aria-hidden="true" tabindex="-1"></a>plot_3 <span class="ot">&lt;-</span>  eoc_m <span class="sc">|&gt;</span> </span>
<span id="cb24-284"><a href="#cb24-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(q, t_cost))<span class="sc">+</span></span>
<span id="cb24-285"><a href="#cb24-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"cyan3"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb24-286"><a href="#cb24-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-287"><a href="#cb24-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-288"><a href="#cb24-288" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Transaction costs:  k * (demand/q)"</span>,</span>
<span id="cb24-289"><a href="#cb24-289" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Order quantity"</span>,</span>
<span id="cb24-290"><a href="#cb24-290" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cost"</span></span>
<span id="cb24-291"><a href="#cb24-291" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-292"><a href="#cb24-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-293"><a href="#cb24-293" aria-hidden="true" tabindex="-1"></a><span class="co"># Make it in long format for the labels in the ggplot</span></span>
<span id="cb24-294"><a href="#cb24-294" aria-hidden="true" tabindex="-1"></a>plot_4 <span class="ot">&lt;-</span> eoc_m <span class="sc">|&gt;</span> <span class="fu">pivot_longer</span>(</span>
<span id="cb24-295"><a href="#cb24-295" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="fu">c</span>(h_cost, t_cost, total_cost), </span>
<span id="cb24-296"><a href="#cb24-296" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">"cost_type"</span>, </span>
<span id="cb24-297"><a href="#cb24-297" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">"cost_value"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb24-298"><a href="#cb24-298" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cost_type =</span> <span class="fu">factor</span>(cost_type, </span>
<span id="cb24-299"><a href="#cb24-299" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"h_cost"</span>, <span class="st">"t_cost"</span>, <span class="st">"total_cost"</span>),</span>
<span id="cb24-300"><a href="#cb24-300" aria-hidden="true" tabindex="-1"></a>                              <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Holding Cost"</span>, <span class="st">"Transaction Cost"</span>, <span class="st">"Total Cost"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb24-301"><a href="#cb24-301" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> q, <span class="at">y =</span> cost_value, <span class="at">color =</span> cost_type)) <span class="sc">+</span></span>
<span id="cb24-302"><a href="#cb24-302" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-303"><a href="#cb24-303" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Holding Cost"</span> <span class="ot">=</span> <span class="st">"darkorange"</span>,</span>
<span id="cb24-304"><a href="#cb24-304" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"Transaction Cost"</span> <span class="ot">=</span> <span class="st">"cyan3"</span>,</span>
<span id="cb24-305"><a href="#cb24-305" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"Total Cost"</span> <span class="ot">=</span> <span class="st">"dodgerblue4"</span>)) <span class="sc">+</span></span>
<span id="cb24-306"><a href="#cb24-306" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-307"><a href="#cb24-307" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb24-308"><a href="#cb24-308" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Order quantity"</span>,</span>
<span id="cb24-309"><a href="#cb24-309" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Costs"</span>,</span>
<span id="cb24-310"><a href="#cb24-310" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"Cost Type:"</span>,</span>
<span id="cb24-311"><a href="#cb24-311" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Economic Order Quantity (EOQ) Cost Analysis"</span></span>
<span id="cb24-312"><a href="#cb24-312" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb24-313"><a href="#cb24-313" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="fl">3.5</span>), </span>
<span id="cb24-314"><a href="#cb24-314" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb24-315"><a href="#cb24-315" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">3.3</span>, <span class="at">y =</span> <span class="fl">0.68</span>, <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb24-316"><a href="#cb24-316" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"Optim. Area"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb24-317"><a href="#cb24-317" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co"># Position legend at bottom</span></span>
<span id="cb24-318"><a href="#cb24-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-319"><a href="#cb24-319" aria-hidden="true" tabindex="-1"></a>plot_2</span>
<span id="cb24-320"><a href="#cb24-320" aria-hidden="true" tabindex="-1"></a>plot_3</span>
<span id="cb24-321"><a href="#cb24-321" aria-hidden="true" tabindex="-1"></a>plot_4</span>
<span id="cb24-322"><a href="#cb24-322" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb24-323"><a href="#cb24-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-324"><a href="#cb24-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-325"><a href="#cb24-325" aria-hidden="true" tabindex="-1"></a>Holding costs are easy to understand (look at @fig-plots-1); as you increase the order quantity, the more your inventory, therefore more holding costs. But what about transaction cost (@fig-plots-2); imagine you increase the order of hoops for the brewery, the more you increase the order quantity the less transactions with your supplier, but it has a limit. Combine, the total costs (@fig-plots-3), we can observe that there is minimum, which is point we want to archive; this minimum is in a big somewhat flat area, this is great for the practitioner (us)!, it means that there is room for being wrong and the same time not being so wrong. We can obtain the minimum by deriving total costs function over $Q$. This is the derived equation (we will call it $Q^{*}$, "q-star"):</span>
<span id="cb24-326"><a href="#cb24-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-327"><a href="#cb24-327" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-328"><a href="#cb24-328" aria-hidden="true" tabindex="-1"></a>\frac{dC }{dQ} = Q^{*}  =  \sqrt<span class="co">[</span><span class="ot">2</span><span class="co">]</span>{\frac{2kd}{h}}</span>
<span id="cb24-329"><a href="#cb24-329" aria-hidden="true" tabindex="-1"></a>$$ {#eq-qstar}</span>
<span id="cb24-330"><a href="#cb24-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-331"><a href="#cb24-331" aria-hidden="true" tabindex="-1"></a>This means that in order to optimize the order quantity, $Q^*$, you want to avoid the transaction costs by increasing the order quantity, BUT, you don't want to overdo it because by increasing the $Q$, you increase the holding costs $h$ (there will just be too many inventory to handle). As with much in life, it is a **balance**.</span>
<span id="cb24-332"><a href="#cb24-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-333"><a href="#cb24-333" aria-hidden="true" tabindex="-1"></a>We can replace $Q^{*}$ in @eq-qstar to find the minimum cost --- we won't do it.</span>
<span id="cb24-334"><a href="#cb24-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-335"><a href="#cb24-335" aria-hidden="true" tabindex="-1"></a>However, all of this is quite far from reality, and that's okay!!! These kinds of models (deterministic models), in my opinion, are not meant to forecast with infinite precision the phenomena; instead they are meant to make some sense of it and build some intuition, which is often more valuable than doing the model itself. That's why it is worth learning them.</span>
<span id="cb24-336"><a href="#cb24-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-337"><a href="#cb24-337" aria-hidden="true" tabindex="-1"></a><span class="fu"># Stochastic modelling or *A number isn't just a number*</span></span>
<span id="cb24-338"><a href="#cb24-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-339"><a href="#cb24-339" aria-hidden="true" tabindex="-1"></a>Here are the assumptions we have made so far:</span>
<span id="cb24-340"><a href="#cb24-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-341"><a href="#cb24-341" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The **demand**, $d$, is constant</span>
<span id="cb24-342"><a href="#cb24-342" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>There is no **lead time**, $l$, (the waiting time for the supplies to arrive since the order is made)</span>
<span id="cb24-343"><a href="#cb24-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-344"><a href="#cb24-344" aria-hidden="true" tabindex="-1"></a>They are strong assumptions because in reality the demand is variable, and there is lead time which is also variable. We are going to incorporate these assumptions into the model, making it stochastic. Stochastic is just another word for randomness, and a stochastic model is just the incorporation of random variables (in this case $d$, and $l$) to the model. Why? It helps us deal with uncertainty.</span>
<span id="cb24-345"><a href="#cb24-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-346"><a href="#cb24-346" aria-hidden="true" tabindex="-1"></a>e.g. Imagine we want to estimate how much should we order. We use the derived $Q*$ to make an estimate, but that estimate can be interpreted as an average of a normal distribution; if we use it we are saying there is still a 50% cumulative probability that there will not be enough **on-hand** inventory to cover the demand. No good news. In other words, you are gambling that you will have enough on-hand inventory by tossing a coin. This scenario is too risky but that risk can be manageable by taking into account in the model the same uncertainty. Rephrasing: Stochastic models help us make decisions under uncertainty. We will still be making plenty of assumptions but at least this model is more fit for real-case scenarios</span>
<span id="cb24-347"><a href="#cb24-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-348"><a href="#cb24-348" aria-hidden="true" tabindex="-1"></a><span class="fu">## The normal distribution plus words of caution</span></span>
<span id="cb24-349"><a href="#cb24-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-350"><a href="#cb24-350" aria-hidden="true" tabindex="-1"></a>We will be assuming that **demand**, $d$, and **lead time**, $l$, have a normal distribution. Therefore we have to know what the normal distribution is saying. If you know what a PDF, CDF, and quantiles are, you can skip this part.</span>
<span id="cb24-351"><a href="#cb24-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-352"><a href="#cb24-352" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hyperparameters</span></span>
<span id="cb24-353"><a href="#cb24-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-354"><a href="#cb24-354" aria-hidden="true" tabindex="-1"></a>Here is a controversial opinion, I do not like the Normal distribution. I am done, I said it. It just tells there is an expected value, the mean $\mu$, and perturbations around it, the standard deviation $\sigma^2$. That phrasing can be applied to every single stuff, and I am very cautious when the universality principle can be applied, also in a way you are expressing ignorance because if you only know that there is perturbations around a mean, you don't know how that perturbations are behaving, which is the idea, capture that uncertainty of the phenomena. Having said that, normal distributions are very helpful to make estimates despite its universality --- also they are wildly use because of the central limit theorem which ultimately says that every phenomena will behave as a normal distribution as data is gathered to infinite. So assuming normality for **demand**, $d$, and **lead time**, $l$ variables:</span>
<span id="cb24-355"><a href="#cb24-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-356"><a href="#cb24-356" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-357"><a href="#cb24-357" aria-hidden="true" tabindex="-1"></a>d \sim N(\mu_{d}, \sigma_{d}^{2})</span>
<span id="cb24-358"><a href="#cb24-358" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-359"><a href="#cb24-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-360"><a href="#cb24-360" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-361"><a href="#cb24-361" aria-hidden="true" tabindex="-1"></a>l\sim N(\mu_{l}, \sigma_{l}^{2})</span>
<span id="cb24-362"><a href="#cb24-362" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-363"><a href="#cb24-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-364"><a href="#cb24-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-365"><a href="#cb24-365" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb24-366"><a href="#cb24-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-367"><a href="#cb24-367" aria-hidden="true" tabindex="-1"></a>More about skepticism about normal distributions can be found in @taleb2007 book the Black Swan, term taken from the classical problem of inference, Hume's problem. If you like science you should know it.</span>
<span id="cb24-368"><a href="#cb24-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-369"><a href="#cb24-369" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-370"><a href="#cb24-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-371"><a href="#cb24-371" aria-hidden="true" tabindex="-1"></a>We can read the last equations as "demand and lead time follows a normal distribution of with **hyperparameters** mean $\mu_x$ and standard deviation $\sigma^{2}_{x}$". We will only care for the hyperparameters, nothing else, just to make it simple and not dealing with a lot of algebra, also because we can describe this distribution just with these hyperparameters, like in @fig-plot3.</span>
<span id="cb24-372"><a href="#cb24-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-375"><a href="#cb24-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-376"><a href="#cb24-376" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot3</span></span>
<span id="cb24-377"><a href="#cb24-377" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Three normal distributions"</span></span>
<span id="cb24-378"><a href="#cb24-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-379"><a href="#cb24-379" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the normal distribution</span></span>
<span id="cb24-380"><a href="#cb24-380" aria-hidden="true" tabindex="-1"></a>x_norm <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb24-381"><a href="#cb24-381" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="fl">0.01</span>),</span>
<span id="cb24-382"><a href="#cb24-382" aria-hidden="true" tabindex="-1"></a>  <span class="at">norm1 =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>), <span class="co"># this is called the "standard" normal distribution</span></span>
<span id="cb24-383"><a href="#cb24-383" aria-hidden="true" tabindex="-1"></a>  <span class="at">norm2 =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>),</span>
<span id="cb24-384"><a href="#cb24-384" aria-hidden="true" tabindex="-1"></a>  <span class="at">norm3 =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb24-385"><a href="#cb24-385" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Look how we just modify the the hyperparameters</span></span>
<span id="cb24-386"><a href="#cb24-386" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-387"><a href="#cb24-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-388"><a href="#cb24-388" aria-hidden="true" tabindex="-1"></a>plot_5 <span class="ot">&lt;-</span> x_norm <span class="sc">|&gt;</span> </span>
<span id="cb24-389"><a href="#cb24-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb24-390"><a href="#cb24-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> norm1), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-391"><a href="#cb24-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> norm2), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-392"><a href="#cb24-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> norm3), <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-393"><a href="#cb24-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-394"><a href="#cb24-394" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Normal distributions"</span>,</span>
<span id="cb24-395"><a href="#cb24-395" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb24-396"><a href="#cb24-396" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Probability"</span></span>
<span id="cb24-397"><a href="#cb24-397" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-398"><a href="#cb24-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb24-399"><a href="#cb24-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-400"><a href="#cb24-400" aria-hidden="true" tabindex="-1"></a>plot_5</span>
<span id="cb24-401"><a href="#cb24-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-402"><a href="#cb24-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-403"><a href="#cb24-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-404"><a href="#cb24-404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-405"><a href="#cb24-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-406"><a href="#cb24-406" aria-hidden="true" tabindex="-1"></a><span class="fu">### PDF &amp; CDF</span></span>
<span id="cb24-407"><a href="#cb24-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-408"><a href="#cb24-408" aria-hidden="true" tabindex="-1"></a>The normal distribution is a Probability *Density* Function (PDF). That word, density, is important because it tell us that a normal distribution can take a continuous array of values; if we are saying that demand follows a normal distribution we are saying that it can take continuous values. This is not the case: "please give me 2.12419 kegs of beer", that does not make sense. This is another assumption that we are explicitly making.</span>
<span id="cb24-409"><a href="#cb24-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-410"><a href="#cb24-410" aria-hidden="true" tabindex="-1"></a>Another important subject is a Cumulative Density Function (CDF). Every PDF has its CDF. They are just the accumulative probability of of its relative PDF. @fig-plot4 shows both a PDF and CDF of a standardized normal distribution, $X \sim N(\mu = 0, \sigma^2 = 1)$. CDFs are important because they help access the risk of choosing a value within our normal distribution, or any PDF.</span>
<span id="cb24-411"><a href="#cb24-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-414"><a href="#cb24-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-415"><a href="#cb24-415" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot4</span></span>
<span id="cb24-416"><a href="#cb24-416" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Normal PDF and CDF. Look how the mean is half of the CDF, so it's saying that you capture half the probability of any given event that follows a normal PDF"</span></span>
<span id="cb24-417"><a href="#cb24-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-418"><a href="#cb24-418" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data for both PDF and CDF</span></span>
<span id="cb24-419"><a href="#cb24-419" aria-hidden="true" tabindex="-1"></a>df_combined <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb24-420"><a href="#cb24-420" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">0.01</span>),</span>
<span id="cb24-421"><a href="#cb24-421" aria-hidden="true" tabindex="-1"></a>  <span class="at">pdf =</span> <span class="fu">dnorm</span>(x),</span>
<span id="cb24-422"><a href="#cb24-422" aria-hidden="true" tabindex="-1"></a>  <span class="at">cdf =</span> <span class="fu">pnorm</span>(x)</span>
<span id="cb24-423"><a href="#cb24-423" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-424"><a href="#cb24-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-425"><a href="#cb24-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-426"><a href="#cb24-426" aria-hidden="true" tabindex="-1"></a>plot_6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_combined, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb24-427"><a href="#cb24-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pdf, <span class="at">color =</span> <span class="st">"PDF"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-428"><a href="#cb24-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> cdf <span class="sc">*</span> <span class="fu">max</span>(pdf), <span class="at">color =</span> <span class="st">"CDF"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-429"><a href="#cb24-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb24-430"><a href="#cb24-430" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Probability Density (PDF)"</span>,</span>
<span id="cb24-431"><a href="#cb24-431" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>.<span class="sc">/</span><span class="fu">max</span>(df_combined<span class="sc">$</span>pdf), </span>
<span id="cb24-432"><a href="#cb24-432" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">"Cumulative Probability (CDF)"</span>,</span>
<span id="cb24-433"><a href="#cb24-433" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> scales<span class="sc">::</span>percent)</span>
<span id="cb24-434"><a href="#cb24-434" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-435"><a href="#cb24-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb24-436"><a href="#cb24-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"PDF"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>, <span class="st">"CDF"</span> <span class="ot">=</span> <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb24-437"><a href="#cb24-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Standard Normal Distribution: PDF and CDF"</span>,</span>
<span id="cb24-438"><a href="#cb24-438" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Standard Deviations from Mean"</span>,</span>
<span id="cb24-439"><a href="#cb24-439" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Function"</span>) <span class="sc">+</span></span>
<span id="cb24-440"><a href="#cb24-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb24-441"><a href="#cb24-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb24-442"><a href="#cb24-442" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb24-443"><a href="#cb24-443" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb24-444"><a href="#cb24-444" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"orange"</span>),</span>
<span id="cb24-445"><a href="#cb24-445" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"orange"</span>)</span>
<span id="cb24-446"><a href="#cb24-446" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-447"><a href="#cb24-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-448"><a href="#cb24-448" aria-hidden="true" tabindex="-1"></a>plot_6</span>
<span id="cb24-449"><a href="#cb24-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-450"><a href="#cb24-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-451"><a href="#cb24-451" aria-hidden="true" tabindex="-1"></a><span class="fu">### Quantiles &amp; normal rule of thumb</span></span>
<span id="cb24-452"><a href="#cb24-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-453"><a href="#cb24-453" aria-hidden="true" tabindex="-1"></a>There is another property of big importance. While CDFs describe the cumulative probability of a PDF within a range of values, quantiles describe specific points that divide the range of a PDF into equal probabilities. In a normal PDF there is a rule of thumb called *68–95–99.7 rule*, which says that in the quantile $\pm 1\sigma$ we capture 68% of probabilities of any normal distribution, in $\pm 2\sigma$ 95% and $\pm 3\sigma$ 99.7%.</span>
<span id="cb24-454"><a href="#cb24-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-457"><a href="#cb24-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-458"><a href="#cb24-458" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot5</span></span>
<span id="cb24-459"><a href="#cb24-459" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "68–95–99.7 rule. Notice how the quantiles divide the normal distribution in equal length."</span></span>
<span id="cb24-460"><a href="#cb24-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-461"><a href="#cb24-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-462"><a href="#cb24-462" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data for standard normal distribution</span></span>
<span id="cb24-463"><a href="#cb24-463" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">length.out =</span> <span class="dv">1000</span>), <span class="at">y =</span> <span class="fu">dnorm</span>(x))</span>
<span id="cb24-464"><a href="#cb24-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-465"><a href="#cb24-465" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the first plot with empirical rule</span></span>
<span id="cb24-466"><a href="#cb24-466" aria-hidden="true" tabindex="-1"></a>plot_7 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb24-467"><a href="#cb24-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb24-468"><a href="#cb24-468" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-469"><a href="#cb24-469" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add shaded regions for empirical rule</span></span>
<span id="cb24-470"><a href="#cb24-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(x <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">1</span>), </span>
<span id="cb24-471"><a href="#cb24-471" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb24-472"><a href="#cb24-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(x <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">2</span>), </span>
<span id="cb24-473"><a href="#cb24-473" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb24-474"><a href="#cb24-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(x <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">3</span>), </span>
<span id="cb24-475"><a href="#cb24-475" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">fill =</span> <span class="st">"lightpink"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb24-476"><a href="#cb24-476" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-477"><a href="#cb24-477" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add vertical lines for mean and standard deviations</span></span>
<span id="cb24-478"><a href="#cb24-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-479"><a href="#cb24-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb24-480"><a href="#cb24-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb24-481"><a href="#cb24-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb24-482"><a href="#cb24-482" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-483"><a href="#cb24-483" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add annotations</span></span>
<span id="cb24-484"><a href="#cb24-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.1</span>, <span class="at">label =</span> <span class="st">"Mean (μ = 0)"</span>, </span>
<span id="cb24-485"><a href="#cb24-485" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-486"><a href="#cb24-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">label =</span> <span class="st">"68% within ±1σ"</span>, </span>
<span id="cb24-487"><a href="#cb24-487" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb24-488"><a href="#cb24-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">label =</span> <span class="st">"95% within ±2σ"</span>, </span>
<span id="cb24-489"><a href="#cb24-489" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb24-490"><a href="#cb24-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="fl">0.2</span>, <span class="at">label =</span> <span class="st">"99.7% within ±3σ"</span>, </span>
<span id="cb24-491"><a href="#cb24-491" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb24-492"><a href="#cb24-492" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-493"><a href="#cb24-493" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Customize theme and labels</span></span>
<span id="cb24-494"><a href="#cb24-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Standard Normal Distribution with quantiles"</span>,</span>
<span id="cb24-495"><a href="#cb24-495" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"68-95-99.7 Rule (One, Two, Three Standard Deviations)"</span>,</span>
<span id="cb24-496"><a href="#cb24-496" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Standard Deviations from Mean"</span>, </span>
<span id="cb24-497"><a href="#cb24-497" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb24-498"><a href="#cb24-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span>
<span id="cb24-499"><a href="#cb24-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-500"><a href="#cb24-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-501"><a href="#cb24-501" aria-hidden="true" tabindex="-1"></a>plot_7</span>
<span id="cb24-502"><a href="#cb24-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-503"><a href="#cb24-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-504"><a href="#cb24-504" aria-hidden="true" tabindex="-1"></a>If you think a quantile is just another way of describing a CDF, you are not alone, it is a common misconception. They are closely related and this relationship will become important. While a CDF function, $F(x)$, computes the cumulative range of probabilities, $p$, that are bigger or equal of $x$, $P(X \le  x) = F(x) = p$; a quantile function computes the value, $x$, to obtain a range of probabilities $p$. In other words a quantile function is the inverse of the CDF function, $F^{-1}(p) = x$. This is the explicit relationship:</span>
<span id="cb24-505"><a href="#cb24-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-506"><a href="#cb24-506" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-507"><a href="#cb24-507" aria-hidden="true" tabindex="-1"></a>F(x) = p  \quad \leftrightharpoons  \quad F^{-1}(p) = x</span>
<span id="cb24-508"><a href="#cb24-508" aria-hidden="true" tabindex="-1"></a>$$ {#eq-inversecdf}</span>
<span id="cb24-509"><a href="#cb24-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-510"><a href="#cb24-510" aria-hidden="true" tabindex="-1"></a><span class="fu">## Stochastic EOQ model</span></span>
<span id="cb24-511"><a href="#cb24-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-512"><a href="#cb24-512" aria-hidden="true" tabindex="-1"></a>The objective in transforming the EOQ model into a stochastic model is to increase the quality of our **service level**, which means serving our clients in time and full. Remember we are considering demand and lead time as random variables for the model.</span>
<span id="cb24-513"><a href="#cb24-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-514"><a href="#cb24-514" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-515"><a href="#cb24-515" aria-hidden="true" tabindex="-1"></a>d \sim N(\mu_{d}, \sigma_{d}^{2})</span>
<span id="cb24-516"><a href="#cb24-516" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-517"><a href="#cb24-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-518"><a href="#cb24-518" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-519"><a href="#cb24-519" aria-hidden="true" tabindex="-1"></a>l\sim N(\mu_{l}, \sigma_{l}^{2})</span>
<span id="cb24-520"><a href="#cb24-520" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-521"><a href="#cb24-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-522"><a href="#cb24-522" aria-hidden="true" tabindex="-1"></a><span class="fu">### Service Level ($\alpha$) &amp; Safety Stocks</span></span>
<span id="cb24-523"><a href="#cb24-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-524"><a href="#cb24-524" aria-hidden="true" tabindex="-1"></a>**Safety stocks**, $S_s$, are a very useful buffer when we face an unusual demand. They are extra on hand inventory as a backup when we finish our predicted inventory level. They are related with the service level, $\alpha$, which is often expressed as percentage. How do they relate? Well by this seem to be complex equation:</span>
<span id="cb24-525"><a href="#cb24-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-526"><a href="#cb24-526" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-527"><a href="#cb24-527" aria-hidden="true" tabindex="-1"></a>S_{s} = Z_{\alpha}\sigma_{l_{d}}</span>
<span id="cb24-528"><a href="#cb24-528" aria-hidden="true" tabindex="-1"></a>$$ {#eq-ss}</span>
<span id="cb24-529"><a href="#cb24-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-530"><a href="#cb24-530" aria-hidden="true" tabindex="-1"></a>Let's understand this equation</span>
<span id="cb24-531"><a href="#cb24-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-532"><a href="#cb24-532" aria-hidden="true" tabindex="-1"></a>**Factor service level**, $Z_{\alpha}$:</span>
<span id="cb24-533"><a href="#cb24-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-534"><a href="#cb24-534" aria-hidden="true" tabindex="-1"></a>What does it mean wanting to have 95% of service level, $\alpha$?</span>
<span id="cb24-535"><a href="#cb24-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-536"><a href="#cb24-536" aria-hidden="true" tabindex="-1"></a>We have periodic demand that follows a normal distribution.</span>
<span id="cb24-537"><a href="#cb24-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-538"><a href="#cb24-538" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-539"><a href="#cb24-539" aria-hidden="true" tabindex="-1"></a>d \sim N(\mu_{d}, \sigma_{d})</span>
<span id="cb24-540"><a href="#cb24-540" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-541"><a href="#cb24-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-542"><a href="#cb24-542" aria-hidden="true" tabindex="-1"></a>If we compute the CDF of $d$ for any given value $x$, it will provide us with the probability that will below of $x$. We want to be extra sure about our computation of $x$, we want 95% of confidence/probability about $x$. We already know $d$ (a.k.a the probability density of demand) and we know that our objective is 95% (a.k.a. $\alpha$); we don't want the CDF we want the quantile function.</span>
<span id="cb24-543"><a href="#cb24-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-544"><a href="#cb24-544" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-545"><a href="#cb24-545" aria-hidden="true" tabindex="-1"></a>F_{d}(z) = \alpha \rightarrow F_{d}^{-1} (\alpha) = z </span>
<span id="cb24-546"><a href="#cb24-546" aria-hidden="true" tabindex="-1"></a>$$ {#eq-alpha}</span>
<span id="cb24-547"><a href="#cb24-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-548"><a href="#cb24-548" aria-hidden="true" tabindex="-1"></a>This is the same property as in @eq-inversecdf but applied to the demand distribution. @eq-alpha is equal to the standard normal quantile function ($\Phi(\alpha)$)</span>
<span id="cb24-549"><a href="#cb24-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-550"><a href="#cb24-550" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-551"><a href="#cb24-551" aria-hidden="true" tabindex="-1"></a>F_{d}^{-1}(\alpha) = \Phi^{-1}(\alpha) = z_{\alpha}</span>
<span id="cb24-552"><a href="#cb24-552" aria-hidden="true" tabindex="-1"></a>$$ {#eq-factorServiceLevel}</span>
<span id="cb24-553"><a href="#cb24-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-554"><a href="#cb24-554" aria-hidden="true" tabindex="-1"></a>::: {.callout-note appearance="simple"}</span>
<span id="cb24-555"><a href="#cb24-555" aria-hidden="true" tabindex="-1"></a>$d$ can be computed from historical demand or by a forecast</span>
<span id="cb24-556"><a href="#cb24-556" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-557"><a href="#cb24-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-558"><a href="#cb24-558" aria-hidden="true" tabindex="-1"></a>**What about the other term, in** @eq-ss ?:</span>
<span id="cb24-559"><a href="#cb24-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-560"><a href="#cb24-560" aria-hidden="true" tabindex="-1"></a>::: callout-warning</span>
<span id="cb24-561"><a href="#cb24-561" aria-hidden="true" tabindex="-1"></a>Many probability theory terms coming. Read them, try to understand them. They are confusing. I would give at the end a way of how you can think of them intuitively.</span>
<span id="cb24-562"><a href="#cb24-562" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-563"><a href="#cb24-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-564"><a href="#cb24-564" aria-hidden="true" tabindex="-1"></a>$Z_\alpha$ is just a factor term that will be multiplied by $\sigma_{d_{l}}$, which can be interpreted as the *variability of demand, and lead time*. @eq-ss is telling us that in order to determine the safety stocks we have to account the variability of two random variables $l$ and $d$. To do that we need the product of two random variables collapsing into a quantity that represents the integrated variability of $l$ and $d$. **How to think about it:** $\sigma_{d_{l}}$ is the area of risk of an inventory policy, the factor $Z_{\alpha}$ determines how much risk are we willing to minimize, the more we want to minimize (by increasing $\alpha$, service level), the more safety stocks, BUT, the more inventory costs by the holding costs. Something that you have to get clear is that safety stocks is the tool that help us battle the variability of the demand, making them essential to give an optimal service level.</span>
<span id="cb24-565"><a href="#cb24-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-566"><a href="#cb24-566" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb24-567"><a href="#cb24-567" aria-hidden="true" tabindex="-1"></a><span class="fu">## Getting more precise</span></span>
<span id="cb24-568"><a href="#cb24-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-569"><a href="#cb24-569" aria-hidden="true" tabindex="-1"></a>With $\sigma_{d_{l}}$ I am not referring to joint PDF, instead I am referring to a product two random variables (in this case $\sigma_{d}$ and $\sigma_{l}$) which does not create any new distribution, it just describes an area behind the intersection between this two random variables, $l$ and $d$, which accounts their variability, which would be multiplied by $Z_\alpha$ factor to make sure we are $\alpha$ secure of the computation of the safety stocks. If you want to know more about this derivation, search for "product of Gaussians" or "product of random variables".</span>
<span id="cb24-570"><a href="#cb24-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-571"><a href="#cb24-571" aria-hidden="true" tabindex="-1"></a>I write this note because at the beginning I was confused between the difference of a joint PDF, a sum of random variables (convolution) and the product of random variables.</span>
<span id="cb24-572"><a href="#cb24-572" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-573"><a href="#cb24-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-574"><a href="#cb24-574" aria-hidden="true" tabindex="-1"></a><span class="fu">### Integrating the (S, R) policy</span></span>
<span id="cb24-575"><a href="#cb24-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-576"><a href="#cb24-576" aria-hidden="true" tabindex="-1"></a>The derivation of $\sigma_{d_{l}}$ depends on the inventory policy. The $(S, R)$ policy is particularly riskier than others because the risk time is the moment when you make an order for your suppliers, every $R$ period, till the moment it arrives (every $l$, lead time). So the risk period is: $R + l$. I will show the derived equation:</span>
<span id="cb24-577"><a href="#cb24-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-578"><a href="#cb24-578" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-579"><a href="#cb24-579" aria-hidden="true" tabindex="-1"></a>S_{s} = Z_{\alpha}\sigma_{l_{d}} = Z_{\alpha} \sqrt{(\mu_{l} + R)\sigma_{d}^{2} + \sigma_{l}^{2}\mu_{d}^{2}}</span>
<span id="cb24-580"><a href="#cb24-580" aria-hidden="true" tabindex="-1"></a>$$ {#eq-ssSR}</span>
<span id="cb24-581"><a href="#cb24-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-582"><a href="#cb24-582" aria-hidden="true" tabindex="-1"></a><span class="fu"># Dr.House brewery (S, R) stochastic policy simulation</span></span>
<span id="cb24-583"><a href="#cb24-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-584"><a href="#cb24-584" aria-hidden="true" tabindex="-1"></a>After all this heavy literature recap, I hope you aren't too destroyed by it, this is the start of the simulation.</span>
<span id="cb24-585"><a href="#cb24-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-586"><a href="#cb24-586" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1) Setting up the variables</span></span>
<span id="cb24-587"><a href="#cb24-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-588"><a href="#cb24-588" aria-hidden="true" tabindex="-1"></a>Dr.House brewery wants to simulate its daily **net inventory**:</span>
<span id="cb24-589"><a href="#cb24-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-590"><a href="#cb24-590" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-591"><a href="#cb24-591" aria-hidden="true" tabindex="-1"></a>net\ inventory = on\ hand\ inventory\ + in\ transit\ inventory\ - backorders </span>
<span id="cb24-592"><a href="#cb24-592" aria-hidden="true" tabindex="-1"></a>$$ {#eq-net}</span>
<span id="cb24-593"><a href="#cb24-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-594"><a href="#cb24-594" aria-hidden="true" tabindex="-1"></a>But before starting they made some research and obtained the below parameters shown in the table. Notice the choice of using a service level, $\alpha$, of 95% (remember the importance of $\alpha$ for calculating safety stocks @eq-ss).</span>
<span id="cb24-595"><a href="#cb24-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-598"><a href="#cb24-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-599"><a href="#cb24-599" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-table</span></span>
<span id="cb24-600"><a href="#cb24-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-601"><a href="#cb24-601" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Define Lead time and </span></span>
<span id="cb24-602"><a href="#cb24-602" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)         <span class="co"># For reproducibility</span></span>
<span id="cb24-603"><a href="#cb24-603" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">365</span>               <span class="co"># days</span></span>
<span id="cb24-604"><a href="#cb24-604" aria-hidden="true" tabindex="-1"></a>d_mu <span class="ot">&lt;-</span> <span class="dv">100</span>; l_mu <span class="ot">=</span> <span class="dv">4</span>  <span class="co"># daily demand [units/day]</span></span>
<span id="cb24-605"><a href="#cb24-605" aria-hidden="true" tabindex="-1"></a>d_std <span class="ot">&lt;-</span> <span class="dv">25</span>; l_std <span class="ot">=</span> <span class="dv">1</span> <span class="co"># daily lead time </span></span>
<span id="cb24-606"><a href="#cb24-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-607"><a href="#cb24-607" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters:</span></span>
<span id="cb24-608"><a href="#cb24-608" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb24-609"><a href="#cb24-609" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">100</span>, <span class="co"># fixed cost of a single transaction [$/order] </span></span>
<span id="cb24-610"><a href="#cb24-610" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fl">0.5</span>, <span class="co"># yearly holding costs for keeping one single piece in stock [$/unit * year]</span></span>
<span id="cb24-611"><a href="#cb24-611" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_yearly =</span> <span class="dv">365</span> <span class="sc">*</span> d_mu, <span class="co"># yearly expected demand</span></span>
<span id="cb24-612"><a href="#cb24-612" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.95</span></span>
<span id="cb24-613"><a href="#cb24-613" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-614"><a href="#cb24-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-615"><a href="#cb24-615" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the parameter table using gt package</span></span>
<span id="cb24-616"><a href="#cb24-616" aria-hidden="true" tabindex="-1"></a>parameter_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb24-617"><a href="#cb24-617" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parameter =</span> <span class="fu">c</span>(<span class="st">"t"</span>, <span class="st">"d_mu"</span>, <span class="st">"l_mu"</span>, <span class="st">"d_std"</span>, <span class="st">"l_std"</span>, <span class="st">"k"</span>, <span class="st">"h"</span>, <span class="st">"d_yearly"</span>, <span class="st">"alpha"</span>),</span>
<span id="cb24-618"><a href="#cb24-618" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(t, d_mu, l_mu, d_std, l_std, params<span class="sc">$</span>k, params<span class="sc">$</span>h, params<span class="sc">$</span>d_yearly, params<span class="sc">$</span>alpha),</span>
<span id="cb24-619"><a href="#cb24-619" aria-hidden="true" tabindex="-1"></a>  <span class="at">Units =</span> <span class="fu">c</span>(<span class="st">"days"</span>, <span class="st">"units/day"</span>, <span class="st">"days"</span>, <span class="st">"units/day"</span>, <span class="st">"days"</span>, <span class="st">"$/order"</span>, <span class="st">"$/(unit*year)"</span>, <span class="st">"units/year"</span>, <span class="st">"dimensionless"</span>),</span>
<span id="cb24-620"><a href="#cb24-620" aria-hidden="true" tabindex="-1"></a>  <span class="at">Meaning =</span> <span class="fu">c</span>(</span>
<span id="cb24-621"><a href="#cb24-621" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Time period (days)"</span>,</span>
<span id="cb24-622"><a href="#cb24-622" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Daily demand mean"</span>,</span>
<span id="cb24-623"><a href="#cb24-623" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Lead time mean"</span>,</span>
<span id="cb24-624"><a href="#cb24-624" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Daily demand standard deviation"</span>,</span>
<span id="cb24-625"><a href="#cb24-625" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Lead time standard deviation"</span>,</span>
<span id="cb24-626"><a href="#cb24-626" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Fixed cost per order"</span>,</span>
<span id="cb24-627"><a href="#cb24-627" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Yearly holding cost per unit"</span>,</span>
<span id="cb24-628"><a href="#cb24-628" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Yearly expected demand"</span>,</span>
<span id="cb24-629"><a href="#cb24-629" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Service level probability"</span></span>
<span id="cb24-630"><a href="#cb24-630" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-631"><a href="#cb24-631" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-632"><a href="#cb24-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-633"><a href="#cb24-633" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the gt table</span></span>
<span id="cb24-634"><a href="#cb24-634" aria-hidden="true" tabindex="-1"></a>gt_table <span class="ot">&lt;-</span> parameter_table <span class="sc">%&gt;%</span></span>
<span id="cb24-635"><a href="#cb24-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-636"><a href="#cb24-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb24-637"><a href="#cb24-637" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Inventory Simulation Parameters"</span>,</span>
<span id="cb24-638"><a href="#cb24-638" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Model parameters and their definitions"</span></span>
<span id="cb24-639"><a href="#cb24-639" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-640"><a href="#cb24-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb24-641"><a href="#cb24-641" aria-hidden="true" tabindex="-1"></a>    <span class="at">Parameter =</span> <span class="st">"Parameter"</span>,</span>
<span id="cb24-642"><a href="#cb24-642" aria-hidden="true" tabindex="-1"></a>    <span class="at">Value =</span> <span class="st">"Value"</span>,</span>
<span id="cb24-643"><a href="#cb24-643" aria-hidden="true" tabindex="-1"></a>    <span class="at">Units =</span> <span class="st">"Units"</span>,</span>
<span id="cb24-644"><a href="#cb24-644" aria-hidden="true" tabindex="-1"></a>    <span class="at">Meaning =</span> <span class="st">"Meaning"</span></span>
<span id="cb24-645"><a href="#cb24-645" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-646"><a href="#cb24-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb24-647"><a href="#cb24-647" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(Value),</span>
<span id="cb24-648"><a href="#cb24-648" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">2</span>,</span>
<span id="cb24-649"><a href="#cb24-649" aria-hidden="true" tabindex="-1"></a>    <span class="at">drop_trailing_zeros =</span> <span class="cn">TRUE</span></span>
<span id="cb24-650"><a href="#cb24-650" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-651"><a href="#cb24-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb24-652"><a href="#cb24-652" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>),</span>
<span id="cb24-653"><a href="#cb24-653" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>()</span>
<span id="cb24-654"><a href="#cb24-654" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-655"><a href="#cb24-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb24-656"><a href="#cb24-656" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_fill</span>(<span class="at">color =</span> <span class="st">"#f7f7f7"</span>),</span>
<span id="cb24-657"><a href="#cb24-657" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>(<span class="at">rows =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(parameter_table), <span class="at">by =</span> <span class="dv">2</span>))</span>
<span id="cb24-658"><a href="#cb24-658" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-659"><a href="#cb24-659" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb24-660"><a href="#cb24-660" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.width =</span> <span class="fu">pct</span>(<span class="dv">95</span>),</span>
<span id="cb24-661"><a href="#cb24-661" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.align =</span> <span class="st">"left"</span></span>
<span id="cb24-662"><a href="#cb24-662" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-663"><a href="#cb24-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-664"><a href="#cb24-664" aria-hidden="true" tabindex="-1"></a>gt_table</span>
<span id="cb24-665"><a href="#cb24-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-666"><a href="#cb24-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-667"><a href="#cb24-667" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2) Estimating S and R</span></span>
<span id="cb24-668"><a href="#cb24-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-669"><a href="#cb24-669" aria-hidden="true" tabindex="-1"></a>In order to make the simulation we have to compute the $R$ (review period) and $S$ (order up-to level). In $(S, R)$ policy $S$ depend on $R$ given that to compute $S$ you need to compute $S_s$ (safety stocks) which depends on $R$ given @eq-ssSR.</span>
<span id="cb24-670"><a href="#cb24-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-671"><a href="#cb24-671" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-672"><a href="#cb24-672" aria-hidden="true" tabindex="-1"></a>R = \frac{Q^{*}}{D} = \sqrt{\frac{2{k}}{hD}}</span>
<span id="cb24-673"><a href="#cb24-673" aria-hidden="true" tabindex="-1"></a>$$ {#eq-R}</span>
<span id="cb24-674"><a href="#cb24-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-675"><a href="#cb24-675" aria-hidden="true" tabindex="-1"></a>Last equation @eq-R was obtained with @eq-qstar. Next step is compute $Z_{\alpha}$ (service factor) by computing the quantile function of an standardize normal distribution,$\Phi^{-1}(\alpha)$ (remember the relation of @eq-alpha).</span>
<span id="cb24-676"><a href="#cb24-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-677"><a href="#cb24-677" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-678"><a href="#cb24-678" aria-hidden="true" tabindex="-1"></a>Z_{\alpha} = \Phi^{-1}(\alpha)</span>
<span id="cb24-679"><a href="#cb24-679" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-680"><a href="#cb24-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-681"><a href="#cb24-681" aria-hidden="true" tabindex="-1"></a>Then we compute @eq-ssSR, shown below.</span>
<span id="cb24-682"><a href="#cb24-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-683"><a href="#cb24-683" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-684"><a href="#cb24-684" aria-hidden="true" tabindex="-1"></a>S_{s} = Z_{\alpha}\sigma_{l_{d}} = Z_{\alpha} \sqrt{(\mu_{l} + R)\sigma_{d}^{2} + \sigma_{l}^{2}\mu_{d}^{2}}</span>
<span id="cb24-685"><a href="#cb24-685" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-686"><a href="#cb24-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-687"><a href="#cb24-687" aria-hidden="true" tabindex="-1"></a>As a last step from this part we compute $S$:</span>
<span id="cb24-688"><a href="#cb24-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-689"><a href="#cb24-689" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-690"><a href="#cb24-690" aria-hidden="true" tabindex="-1"></a>S = d_{l} + d_{R} + S_{s} = \mu_{l}R + \mu_{d} + S_{s}</span>
<span id="cb24-691"><a href="#cb24-691" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-692"><a href="#cb24-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-693"><a href="#cb24-693" aria-hidden="true" tabindex="-1"></a>All of this calculations are done in the code below.</span>
<span id="cb24-694"><a href="#cb24-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-697"><a href="#cb24-697" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-698"><a href="#cb24-698" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: S-and-R</span></span>
<span id="cb24-699"><a href="#cb24-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-700"><a href="#cb24-700" aria-hidden="true" tabindex="-1"></a><span class="co"># Review period (years -&gt; days)</span></span>
<span id="cb24-701"><a href="#cb24-701" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>k) <span class="sc">/</span> (params<span class="sc">$</span>h <span class="sc">*</span> params<span class="sc">$</span>d_yearly)) <span class="co"># years between orders</span></span>
<span id="cb24-702"><a href="#cb24-702" aria-hidden="true" tabindex="-1"></a>r_period <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">round</span>(<span class="dv">365</span> <span class="sc">*</span> R))                       <span class="co"># days between reviews (&gt;=1)</span></span>
<span id="cb24-703"><a href="#cb24-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-704"><a href="#cb24-704" aria-hidden="true" tabindex="-1"></a><span class="co"># Safety stock and S</span></span>
<span id="cb24-705"><a href="#cb24-705" aria-hidden="true" tabindex="-1"></a>z_alpha <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(params<span class="sc">$</span>alpha)</span>
<span id="cb24-706"><a href="#cb24-706" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> z_alpha <span class="sc">*</span> <span class="fu">sqrt</span>((l_mu <span class="sc">+</span> r_period) <span class="sc">*</span> d_std<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> l_std<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> d_mu<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb24-707"><a href="#cb24-707" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> (l_mu <span class="sc">+</span> r_period) <span class="sc">*</span> d_mu <span class="sc">+</span> ss</span>
<span id="cb24-708"><a href="#cb24-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-709"><a href="#cb24-709" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-710"><a href="#cb24-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-711"><a href="#cb24-711" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3) Initialize vectors</span></span>
<span id="cb24-712"><a href="#cb24-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-713"><a href="#cb24-713" aria-hidden="true" tabindex="-1"></a>We are going to run a for-loop like the one that produced @fig-plot1 but much more complex. As describe we want to simulate the net inventory, shown in @eq-net. But first let's breaking down into parts and look at the code --- it will make sense in the next section.</span>
<span id="cb24-714"><a href="#cb24-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-717"><a href="#cb24-717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-718"><a href="#cb24-718" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Vectors</span></span>
<span id="cb24-719"><a href="#cb24-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-720"><a href="#cb24-720" aria-hidden="true" tabindex="-1"></a>n_days <span class="ot">&lt;-</span> t</span>
<span id="cb24-721"><a href="#cb24-721" aria-hidden="true" tabindex="-1"></a>max_lead_time <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(l_mu <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> l_std) <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb24-722"><a href="#cb24-722" aria-hidden="true" tabindex="-1"></a><span class="co"># in_transit rows are calendar days; we only store arrival quantities</span></span>
<span id="cb24-723"><a href="#cb24-723" aria-hidden="true" tabindex="-1"></a>in_transit <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> n_days <span class="sc">+</span> max_lead_time, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb24-724"><a href="#cb24-724" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(in_transit) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"quantity"</span>)</span>
<span id="cb24-725"><a href="#cb24-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-726"><a href="#cb24-726" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre-sample all daily demand</span></span>
<span id="cb24-727"><a href="#cb24-727" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">round</span>(<span class="fu">rnorm</span>(n_days, d_mu, d_std)))</span>
<span id="cb24-728"><a href="#cb24-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-729"><a href="#cb24-729" aria-hidden="true" tabindex="-1"></a><span class="co"># Outputs of for-loop</span></span>
<span id="cb24-730"><a href="#cb24-730" aria-hidden="true" tabindex="-1"></a>on_hand <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb24-731"><a href="#cb24-731" aria-hidden="true" tabindex="-1"></a>backorders <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb24-732"><a href="#cb24-732" aria-hidden="true" tabindex="-1"></a>inventory_position <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)  <span class="co"># on-hand + on-order - backorders</span></span>
<span id="cb24-733"><a href="#cb24-733" aria-hidden="true" tabindex="-1"></a>orders <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb24-734"><a href="#cb24-734" aria-hidden="true" tabindex="-1"></a>lead_times <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb24-735"><a href="#cb24-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-736"><a href="#cb24-736" aria-hidden="true" tabindex="-1"></a><span class="co"># initial state (before day 1)</span></span>
<span id="cb24-737"><a href="#cb24-737" aria-hidden="true" tabindex="-1"></a>on_hand_prev <span class="ot">&lt;-</span> S      <span class="co"># starting full to S</span></span>
<span id="cb24-738"><a href="#cb24-738" aria-hidden="true" tabindex="-1"></a>backorders_prev <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-739"><a href="#cb24-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-740"><a href="#cb24-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-741"><a href="#cb24-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-742"><a href="#cb24-742" aria-hidden="true" tabindex="-1"></a><span class="fu">### A word about in-transit/on-order inventory</span></span>
<span id="cb24-743"><a href="#cb24-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-744"><a href="#cb24-744" aria-hidden="true" tabindex="-1"></a>In-transit inventory, for the purposes of this simulation, works as a calendar that will keep track how many days has been since an order was made. More formally it is a calendar-based matrix of future scheduled arrivals. This is what makes the model to have *memory* about the lead-time variability, $\sigma_{l}$.</span>
<span id="cb24-745"><a href="#cb24-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-746"><a href="#cb24-746" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4) For-loop simulation</span></span>
<span id="cb24-747"><a href="#cb24-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-748"><a href="#cb24-748" aria-hidden="true" tabindex="-1"></a>Let's start with the **friendly** explication of the simulation:</span>
<span id="cb24-749"><a href="#cb24-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-750"><a href="#cb24-750" aria-hidden="true" tabindex="-1"></a>Every loop is a day (<span class="in">`for (day in 1:n_days){}`</span>). An inventory-day is divided in three:</span>
<span id="cb24-751"><a href="#cb24-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-752"><a href="#cb24-752" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Mornings**:</span>
<span id="cb24-753"><a href="#cb24-753" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>In the morning we check whether there is any arrival from our suppliers <span class="in">`arrival_qty &lt;- in_transit[day, "quantity"]`</span></span>
<span id="cb24-754"><a href="#cb24-754" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Also we check if we have any back-order <span class="in">`backorders_prev &gt; 0`</span>. If we do, <span class="in">`backorders_prev &gt; 0 = TRUE`</span>, then that means we haven't had any on-hand inventory, which means that the only way to fulfill a back-order is if there is any arrival from the in-transit suppliers <span class="in">`arrival_qty &gt; 0`</span>. If <span class="in">`arrival_qty &gt; 0 = TRUE`</span> then we check if the inventory is enough to fulfill all back-orders (the condition is <span class="in">`arrival_qty &gt;= backorders_prev`</span>), if not then you just subtract the remaining back-orders with the previous ones. The code for all the morning part is down below.</span>
<span id="cb24-755"><a href="#cb24-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-758"><a href="#cb24-758" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-759"><a href="#cb24-759" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Morning-loop-part</span></span>
<span id="cb24-760"><a href="#cb24-760" aria-hidden="true" tabindex="-1"></a><span class="co">#| execute: FALSE</span></span>
<span id="cb24-761"><a href="#cb24-761" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: FALSE   # Show results (output)</span></span>
<span id="cb24-762"><a href="#cb24-762" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: FALSE     # Show output</span></span>
<span id="cb24-763"><a href="#cb24-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-764"><a href="#cb24-764" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (day <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_days) {</span>
<span id="cb24-765"><a href="#cb24-765" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrivals this morning</span></span>
<span id="cb24-766"><a href="#cb24-766" aria-hidden="true" tabindex="-1"></a>  arrival_qty <span class="ot">&lt;-</span> in_transit[day, <span class="st">"quantity"</span>]</span>
<span id="cb24-767"><a href="#cb24-767" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-768"><a href="#cb24-768" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) allocate arrivals to existing bac-korders first</span></span>
<span id="cb24-769"><a href="#cb24-769" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (arrival_qty <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> backorders_prev <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb24-770"><a href="#cb24-770" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (arrival_qty <span class="sc">&gt;=</span> backorders_prev) {</span>
<span id="cb24-771"><a href="#cb24-771" aria-hidden="true" tabindex="-1"></a>      arrival_remaining <span class="ot">&lt;-</span> arrival_qty <span class="sc">-</span> backorders_prev</span>
<span id="cb24-772"><a href="#cb24-772" aria-hidden="true" tabindex="-1"></a>      backorders_cur <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-773"><a href="#cb24-773" aria-hidden="true" tabindex="-1"></a>      on_hand_cur <span class="ot">&lt;-</span> on_hand_prev <span class="sc">+</span> arrival_remaining</span>
<span id="cb24-774"><a href="#cb24-774" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb24-775"><a href="#cb24-775" aria-hidden="true" tabindex="-1"></a>      <span class="co"># arrival not enough to clear back-orders</span></span>
<span id="cb24-776"><a href="#cb24-776" aria-hidden="true" tabindex="-1"></a>      backorders_cur <span class="ot">&lt;-</span> backorders_prev <span class="sc">-</span> arrival_qty</span>
<span id="cb24-777"><a href="#cb24-777" aria-hidden="true" tabindex="-1"></a>      on_hand_cur <span class="ot">&lt;-</span> on_hand_prev  <span class="co"># usually 0 when back-orders exist</span></span>
<span id="cb24-778"><a href="#cb24-778" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-779"><a href="#cb24-779" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-780"><a href="#cb24-780" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no back-orders or no arrivals</span></span>
<span id="cb24-781"><a href="#cb24-781" aria-hidden="true" tabindex="-1"></a>    backorders_cur <span class="ot">&lt;-</span> backorders_prev</span>
<span id="cb24-782"><a href="#cb24-782" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> on_hand_prev <span class="sc">+</span> arrival_qty</span>
<span id="cb24-783"><a href="#cb24-783" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-784"><a href="#cb24-784" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb24-785"><a href="#cb24-785" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb24-786"><a href="#cb24-786" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;.... Next part, during the day</span></span>
<span id="cb24-787"><a href="#cb24-787" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-788"><a href="#cb24-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-789"><a href="#cb24-789" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-790"><a href="#cb24-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-791"><a href="#cb24-791" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>During the day.</span>
<span id="cb24-792"><a href="#cb24-792" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We first ask us *"Can we satisfy the today's demand given our on-hand inventory?* with the condition <span class="in">`on_hand_cur &gt;= d[day]`</span>.</span>
<span id="cb24-793"><a href="#cb24-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-796"><a href="#cb24-796" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-797"><a href="#cb24-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Day-loop-part</span></span>
<span id="cb24-798"><a href="#cb24-798" aria-hidden="true" tabindex="-1"></a><span class="co">#| execute: FALSE</span></span>
<span id="cb24-799"><a href="#cb24-799" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: FALSE   # Show results (output)</span></span>
<span id="cb24-800"><a href="#cb24-800" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: FALSE     # Show output</span></span>
<span id="cb24-801"><a href="#cb24-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-802"><a href="#cb24-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-803"><a href="#cb24-803" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb24-804"><a href="#cb24-804" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb24-805"><a href="#cb24-805" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb24-806"><a href="#cb24-806" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (on_hand_cur <span class="sc">&gt;=</span> d[day]) {</span>
<span id="cb24-807"><a href="#cb24-807" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> on_hand_cur <span class="sc">-</span> d[day]</span>
<span id="cb24-808"><a href="#cb24-808" aria-hidden="true" tabindex="-1"></a>    <span class="co"># backorders_cur remains whatever it is (possibly 0)</span></span>
<span id="cb24-809"><a href="#cb24-809" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-810"><a href="#cb24-810" aria-hidden="true" tabindex="-1"></a>    <span class="co"># demand exceeds on-hand -&gt; create backorders</span></span>
<span id="cb24-811"><a href="#cb24-811" aria-hidden="true" tabindex="-1"></a>    backorders_cur <span class="ot">&lt;-</span> backorders_cur <span class="sc">+</span> (d[day] <span class="sc">-</span> on_hand_cur)</span>
<span id="cb24-812"><a href="#cb24-812" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-813"><a href="#cb24-813" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-814"><a href="#cb24-814" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb24-815"><a href="#cb24-815" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb24-816"><a href="#cb24-816" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....Next part, end of the day</span></span>
<span id="cb24-817"><a href="#cb24-817" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-818"><a href="#cb24-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-819"><a href="#cb24-819" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Nights.</span>
<span id="cb24-820"><a href="#cb24-820" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We keep track of in-transit inventory --- aside from the daily routine, <span class="in">`on_hand_cur &gt;= d[day]`</span> condition is a safeguard for the last day of the simulation. It prevents an error and ensures that once the model time-period is over, the model stops looking for future arrivals from the in-transit inventory.</span>
<span id="cb24-821"><a href="#cb24-821" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Our Excel with all the daily data has to be updated with the @eq-net (net-inventory is the same as <span class="in">`inventory_position`</span>)</span>
<span id="cb24-822"><a href="#cb24-822" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Finally we make a periodic review $R$ if it is review time, <span class="in">`day %% r_period == 0 = TRUE`</span>. If the condition is <span class="in">`TRUE`</span> we have check the order quantity, the lead-time our suppliers, and approximate the arrival day (trusting in the word our suppliers); we keep track of new order with our in-transit calendar.</span>
<span id="cb24-823"><a href="#cb24-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-826"><a href="#cb24-826" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-827"><a href="#cb24-827" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Night-loop-part</span></span>
<span id="cb24-828"><a href="#cb24-828" aria-hidden="true" tabindex="-1"></a><span class="co">#| execute: FALSE</span></span>
<span id="cb24-829"><a href="#cb24-829" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: FALSE   # Show results (output)</span></span>
<span id="cb24-830"><a href="#cb24-830" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: FALSE     # Show output</span></span>
<span id="cb24-831"><a href="#cb24-831" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-832"><a href="#cb24-832" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (day <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_days) {</span>
<span id="cb24-833"><a href="#cb24-833" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb24-834"><a href="#cb24-834" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb24-835"><a href="#cb24-835" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&gt;....</span></span>
<span id="cb24-836"><a href="#cb24-836" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) compute on-order (future arrivals) and inventory position</span></span>
<span id="cb24-837"><a href="#cb24-837" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (day <span class="sc">&lt;</span> <span class="fu">nrow</span>(in_transit)) {</span>
<span id="cb24-838"><a href="#cb24-838" aria-hidden="true" tabindex="-1"></a>    total_in_transit <span class="ot">&lt;-</span> <span class="fu">sum</span>(in_transit[(day <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(in_transit), <span class="st">"quantity"</span>])</span>
<span id="cb24-839"><a href="#cb24-839" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-840"><a href="#cb24-840" aria-hidden="true" tabindex="-1"></a>    total_in_transit <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-841"><a href="#cb24-841" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-842"><a href="#cb24-842" aria-hidden="true" tabindex="-1"></a>  inv_pos <span class="ot">&lt;-</span> on_hand_cur <span class="sc">+</span> total_in_transit <span class="sc">-</span> backorders_cur</span>
<span id="cb24-843"><a href="#cb24-843" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-844"><a href="#cb24-844" aria-hidden="true" tabindex="-1"></a>  <span class="co"># save</span></span>
<span id="cb24-845"><a href="#cb24-845" aria-hidden="true" tabindex="-1"></a>  on_hand[day] <span class="ot">&lt;-</span> on_hand_cur</span>
<span id="cb24-846"><a href="#cb24-846" aria-hidden="true" tabindex="-1"></a>  backorders[day] <span class="ot">&lt;-</span> backorders_cur</span>
<span id="cb24-847"><a href="#cb24-847" aria-hidden="true" tabindex="-1"></a>  inventory_position[day] <span class="ot">&lt;-</span> inv_pos</span>
<span id="cb24-848"><a href="#cb24-848" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-849"><a href="#cb24-849" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4) periodic review: order up to S (inventory position used)</span></span>
<span id="cb24-850"><a href="#cb24-850" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (day <span class="sc">%%</span> r_period <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb24-851"><a href="#cb24-851" aria-hidden="true" tabindex="-1"></a>    l_time <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, l_mu, l_std)))</span>
<span id="cb24-852"><a href="#cb24-852" aria-hidden="true" tabindex="-1"></a>    order_qty <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, S <span class="sc">-</span> inv_pos)</span>
<span id="cb24-853"><a href="#cb24-853" aria-hidden="true" tabindex="-1"></a>    arrival_day <span class="ot">&lt;-</span> day <span class="sc">+</span> l_time</span>
<span id="cb24-854"><a href="#cb24-854" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (arrival_day <span class="sc">&lt;=</span> <span class="fu">nrow</span>(in_transit)) {</span>
<span id="cb24-855"><a href="#cb24-855" aria-hidden="true" tabindex="-1"></a>      in_transit[arrival_day, <span class="st">"quantity"</span>] <span class="ot">&lt;-</span> in_transit[arrival_day, <span class="st">"quantity"</span>] <span class="sc">+</span> order_qty</span>
<span id="cb24-856"><a href="#cb24-856" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb24-857"><a href="#cb24-857" aria-hidden="true" tabindex="-1"></a>      <span class="co"># arrival beyond simulation time period/horizon — ignore or extend in_transit</span></span>
<span id="cb24-858"><a href="#cb24-858" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Here we ignore</span></span>
<span id="cb24-859"><a href="#cb24-859" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-860"><a href="#cb24-860" aria-hidden="true" tabindex="-1"></a>    orders[day] <span class="ot">&lt;-</span> order_qty</span>
<span id="cb24-861"><a href="#cb24-861" aria-hidden="true" tabindex="-1"></a>    lead_times[day] <span class="ot">&lt;-</span> l_time</span>
<span id="cb24-862"><a href="#cb24-862" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-863"><a href="#cb24-863" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Day %3d REVIEW: inv_pos = %.1f, order = %.0f, lead = %d (arrive day %d)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb24-864"><a href="#cb24-864" aria-hidden="true" tabindex="-1"></a>                day, inv_pos, order_qty, l_time, arrival_day))</span>
<span id="cb24-865"><a href="#cb24-865" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-866"><a href="#cb24-866" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-867"><a href="#cb24-867" aria-hidden="true" tabindex="-1"></a>  <span class="co"># update previous for next day</span></span>
<span id="cb24-868"><a href="#cb24-868" aria-hidden="true" tabindex="-1"></a>  on_hand_prev <span class="ot">&lt;-</span> on_hand_cur</span>
<span id="cb24-869"><a href="#cb24-869" aria-hidden="true" tabindex="-1"></a>  backorders_prev <span class="ot">&lt;-</span> backorders_cur</span>
<span id="cb24-870"><a href="#cb24-870" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-871"><a href="#cb24-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-872"><a href="#cb24-872" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-873"><a href="#cb24-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-874"><a href="#cb24-874" aria-hidden="true" tabindex="-1"></a>Below the whole code:</span>
<span id="cb24-875"><a href="#cb24-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-878"><a href="#cb24-878" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-879"><a href="#cb24-879" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Stochatic-Simulation</span></span>
<span id="cb24-880"><a href="#cb24-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-881"><a href="#cb24-881" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (day <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_days) {</span>
<span id="cb24-882"><a href="#cb24-882" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrivals this morning</span></span>
<span id="cb24-883"><a href="#cb24-883" aria-hidden="true" tabindex="-1"></a>  arrival_qty <span class="ot">&lt;-</span> in_transit[day, <span class="st">"quantity"</span>]</span>
<span id="cb24-884"><a href="#cb24-884" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-885"><a href="#cb24-885" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) allocate arrivals to existing backorders first</span></span>
<span id="cb24-886"><a href="#cb24-886" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (arrival_qty <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> backorders_prev <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb24-887"><a href="#cb24-887" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (arrival_qty <span class="sc">&gt;=</span> backorders_prev) {</span>
<span id="cb24-888"><a href="#cb24-888" aria-hidden="true" tabindex="-1"></a>      arrival_remaining <span class="ot">&lt;-</span> arrival_qty <span class="sc">-</span> backorders_prev</span>
<span id="cb24-889"><a href="#cb24-889" aria-hidden="true" tabindex="-1"></a>      backorders_cur <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-890"><a href="#cb24-890" aria-hidden="true" tabindex="-1"></a>      on_hand_cur <span class="ot">&lt;-</span> on_hand_prev <span class="sc">+</span> arrival_remaining</span>
<span id="cb24-891"><a href="#cb24-891" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb24-892"><a href="#cb24-892" aria-hidden="true" tabindex="-1"></a>      <span class="co"># arrival not enough to clear backorders</span></span>
<span id="cb24-893"><a href="#cb24-893" aria-hidden="true" tabindex="-1"></a>      backorders_cur <span class="ot">&lt;-</span> backorders_prev <span class="sc">-</span> arrival_qty</span>
<span id="cb24-894"><a href="#cb24-894" aria-hidden="true" tabindex="-1"></a>      on_hand_cur <span class="ot">&lt;-</span> on_hand_prev  <span class="co"># usually 0 when backorders exist</span></span>
<span id="cb24-895"><a href="#cb24-895" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-896"><a href="#cb24-896" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-897"><a href="#cb24-897" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no outstanding backorders or no arrivals</span></span>
<span id="cb24-898"><a href="#cb24-898" aria-hidden="true" tabindex="-1"></a>    backorders_cur <span class="ot">&lt;-</span> backorders_prev</span>
<span id="cb24-899"><a href="#cb24-899" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> on_hand_prev <span class="sc">+</span> arrival_qty</span>
<span id="cb24-900"><a href="#cb24-900" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-901"><a href="#cb24-901" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-902"><a href="#cb24-902" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) satisfy today's demand (d[day])</span></span>
<span id="cb24-903"><a href="#cb24-903" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (on_hand_cur <span class="sc">&gt;=</span> d[day]) {</span>
<span id="cb24-904"><a href="#cb24-904" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> on_hand_cur <span class="sc">-</span> d[day]</span>
<span id="cb24-905"><a href="#cb24-905" aria-hidden="true" tabindex="-1"></a>    <span class="co"># backorders_cur remains whatever it is (possibly 0)</span></span>
<span id="cb24-906"><a href="#cb24-906" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-907"><a href="#cb24-907" aria-hidden="true" tabindex="-1"></a>    <span class="co"># demand exceeds on-hand -&gt; create backorders</span></span>
<span id="cb24-908"><a href="#cb24-908" aria-hidden="true" tabindex="-1"></a>    backorders_cur <span class="ot">&lt;-</span> backorders_cur <span class="sc">+</span> (d[day] <span class="sc">-</span> on_hand_cur)</span>
<span id="cb24-909"><a href="#cb24-909" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-910"><a href="#cb24-910" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-911"><a href="#cb24-911" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-912"><a href="#cb24-912" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) compute on-order (future arrivals) and inventory position</span></span>
<span id="cb24-913"><a href="#cb24-913" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (day <span class="sc">&lt;</span> <span class="fu">nrow</span>(in_transit)) {</span>
<span id="cb24-914"><a href="#cb24-914" aria-hidden="true" tabindex="-1"></a>    total_in_transit <span class="ot">&lt;-</span> <span class="fu">sum</span>(in_transit[(day <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(in_transit), <span class="st">"quantity"</span>])</span>
<span id="cb24-915"><a href="#cb24-915" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-916"><a href="#cb24-916" aria-hidden="true" tabindex="-1"></a>    total_in_transit <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-917"><a href="#cb24-917" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-918"><a href="#cb24-918" aria-hidden="true" tabindex="-1"></a>  inv_pos <span class="ot">&lt;-</span> on_hand_cur <span class="sc">+</span> total_in_transit <span class="sc">-</span> backorders_cur</span>
<span id="cb24-919"><a href="#cb24-919" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-920"><a href="#cb24-920" aria-hidden="true" tabindex="-1"></a>  <span class="co"># save</span></span>
<span id="cb24-921"><a href="#cb24-921" aria-hidden="true" tabindex="-1"></a>  on_hand[day] <span class="ot">&lt;-</span> on_hand_cur</span>
<span id="cb24-922"><a href="#cb24-922" aria-hidden="true" tabindex="-1"></a>  backorders[day] <span class="ot">&lt;-</span> backorders_cur</span>
<span id="cb24-923"><a href="#cb24-923" aria-hidden="true" tabindex="-1"></a>  inventory_position[day] <span class="ot">&lt;-</span> inv_pos</span>
<span id="cb24-924"><a href="#cb24-924" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-925"><a href="#cb24-925" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4) periodic review: order up to S (inventory position used)</span></span>
<span id="cb24-926"><a href="#cb24-926" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (day <span class="sc">%%</span> r_period <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb24-927"><a href="#cb24-927" aria-hidden="true" tabindex="-1"></a>    l_time <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, l_mu, l_std)))</span>
<span id="cb24-928"><a href="#cb24-928" aria-hidden="true" tabindex="-1"></a>    order_qty <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, S <span class="sc">-</span> inv_pos)</span>
<span id="cb24-929"><a href="#cb24-929" aria-hidden="true" tabindex="-1"></a>    arrival_day <span class="ot">&lt;-</span> day <span class="sc">+</span> l_time</span>
<span id="cb24-930"><a href="#cb24-930" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (arrival_day <span class="sc">&lt;=</span> <span class="fu">nrow</span>(in_transit)) {</span>
<span id="cb24-931"><a href="#cb24-931" aria-hidden="true" tabindex="-1"></a>      in_transit[arrival_day, <span class="st">"quantity"</span>] <span class="ot">&lt;-</span> in_transit[arrival_day, <span class="st">"quantity"</span>] <span class="sc">+</span> order_qty</span>
<span id="cb24-932"><a href="#cb24-932" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb24-933"><a href="#cb24-933" aria-hidden="true" tabindex="-1"></a>      <span class="co"># arrival beyond simulation time period/horizon — ignore or extend in_transit</span></span>
<span id="cb24-934"><a href="#cb24-934" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Here we ignore</span></span>
<span id="cb24-935"><a href="#cb24-935" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-936"><a href="#cb24-936" aria-hidden="true" tabindex="-1"></a>    orders[day] <span class="ot">&lt;-</span> order_qty</span>
<span id="cb24-937"><a href="#cb24-937" aria-hidden="true" tabindex="-1"></a>    lead_times[day] <span class="ot">&lt;-</span> l_time</span>
<span id="cb24-938"><a href="#cb24-938" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-939"><a href="#cb24-939" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Day %3d REVIEW: inv_pos = %.1f, order = %.0f, lead = %d (arrive day %d)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb24-940"><a href="#cb24-940" aria-hidden="true" tabindex="-1"></a>                day, inv_pos, order_qty, l_time, arrival_day))</span>
<span id="cb24-941"><a href="#cb24-941" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-942"><a href="#cb24-942" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-943"><a href="#cb24-943" aria-hidden="true" tabindex="-1"></a>  <span class="co"># update previous for next day</span></span>
<span id="cb24-944"><a href="#cb24-944" aria-hidden="true" tabindex="-1"></a>  on_hand_prev <span class="ot">&lt;-</span> on_hand_cur</span>
<span id="cb24-945"><a href="#cb24-945" aria-hidden="true" tabindex="-1"></a>  backorders_prev <span class="ot">&lt;-</span> backorders_cur</span>
<span id="cb24-946"><a href="#cb24-946" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-947"><a href="#cb24-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-948"><a href="#cb24-948" aria-hidden="true" tabindex="-1"></a><span class="co"># We compute a tibble data frame for a plot</span></span>
<span id="cb24-949"><a href="#cb24-949" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb24-950"><a href="#cb24-950" aria-hidden="true" tabindex="-1"></a>  <span class="at">days =</span> <span class="dv">1</span><span class="sc">:</span>n_days,</span>
<span id="cb24-951"><a href="#cb24-951" aria-hidden="true" tabindex="-1"></a>  <span class="at">on_hand =</span> on_hand,</span>
<span id="cb24-952"><a href="#cb24-952" aria-hidden="true" tabindex="-1"></a>  <span class="at">backorders =</span> backorders,</span>
<span id="cb24-953"><a href="#cb24-953" aria-hidden="true" tabindex="-1"></a>  <span class="at">inventory_position =</span> inventory_position,</span>
<span id="cb24-954"><a href="#cb24-954" aria-hidden="true" tabindex="-1"></a>  <span class="at">demand =</span> d,</span>
<span id="cb24-955"><a href="#cb24-955" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_qty =</span> orders</span>
<span id="cb24-956"><a href="#cb24-956" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-957"><a href="#cb24-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-958"><a href="#cb24-958" aria-hidden="true" tabindex="-1"></a>results <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb24-959"><a href="#cb24-959" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-960"><a href="#cb24-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-961"><a href="#cb24-961" aria-hidden="true" tabindex="-1"></a>PLOT!!!!!!</span>
<span id="cb24-962"><a href="#cb24-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-965"><a href="#cb24-965" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-966"><a href="#cb24-966" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot6</span></span>
<span id="cb24-967"><a href="#cb24-967" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "1st Simulation:In red is the back-orders and in blue the on-hand inventory "</span></span>
<span id="cb24-968"><a href="#cb24-968" aria-hidden="true" tabindex="-1"></a>results<span class="sc">|&gt;</span> </span>
<span id="cb24-969"><a href="#cb24-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days)) <span class="sc">+</span></span>
<span id="cb24-970"><a href="#cb24-970" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> on_hand), <span class="at">colour =</span> <span class="st">"#1E90FF"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-971"><a href="#cb24-971" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> backorders), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-972"><a href="#cb24-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-973"><a href="#cb24-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-974"><a href="#cb24-974" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Stochastic simulation of a (R, S) policy"</span>,</span>
<span id="cb24-975"><a href="#cb24-975" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"With alpha = 0.95"</span> </span>
<span id="cb24-976"><a href="#cb24-976" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb24-977"><a href="#cb24-977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="dv">0</span>, n_days, r_period), </span>
<span id="cb24-978"><a href="#cb24-978" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb24-979"><a href="#cb24-979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, n_days, r_period), <span class="at">y =</span> s <span class="sc">+</span> <span class="dv">1</span>, </span>
<span id="cb24-980"><a href="#cb24-980" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Reorder"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>)</span>
<span id="cb24-981"><a href="#cb24-981" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-982"><a href="#cb24-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-983"><a href="#cb24-983" aria-hidden="true" tabindex="-1"></a><span class="fu">### Learning by playing</span></span>
<span id="cb24-984"><a href="#cb24-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-985"><a href="#cb24-985" aria-hidden="true" tabindex="-1"></a>Let's simulate again everything but changing $\alpha$ to 50% and increase the variability of the lead-time $\sigma^{2}_{l}$ to 15.</span>
<span id="cb24-986"><a href="#cb24-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-989"><a href="#cb24-989" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-990"><a href="#cb24-990" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot7</span></span>
<span id="cb24-991"><a href="#cb24-991" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "2ng Simulation: In red is the back-orders and in blue the on-hand inventory. Notice how much redish "</span></span>
<span id="cb24-992"><a href="#cb24-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-993"><a href="#cb24-993" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Define Lead time and </span></span>
<span id="cb24-994"><a href="#cb24-994" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)         <span class="co"># For reproducibility</span></span>
<span id="cb24-995"><a href="#cb24-995" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">365</span>               <span class="co"># days</span></span>
<span id="cb24-996"><a href="#cb24-996" aria-hidden="true" tabindex="-1"></a>d_mu <span class="ot">&lt;-</span> <span class="dv">100</span>; l_mu <span class="ot">=</span> <span class="dv">4</span>  <span class="co"># daily demand [units/day]</span></span>
<span id="cb24-997"><a href="#cb24-997" aria-hidden="true" tabindex="-1"></a>d_std <span class="ot">&lt;-</span> <span class="dv">25</span>; l_std <span class="ot">=</span> <span class="dv">15</span> <span class="co"># daily lead time </span></span>
<span id="cb24-998"><a href="#cb24-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-999"><a href="#cb24-999" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters:</span></span>
<span id="cb24-1000"><a href="#cb24-1000" aria-hidden="true" tabindex="-1"></a>params2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb24-1001"><a href="#cb24-1001" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">100</span>, <span class="co"># fixed cost of a single transaction [$/order] </span></span>
<span id="cb24-1002"><a href="#cb24-1002" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fl">0.5</span>, <span class="co"># yearly holding costs for keeping one single piece in stock [$/unit * year]</span></span>
<span id="cb24-1003"><a href="#cb24-1003" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_yearly =</span> <span class="dv">365</span> <span class="sc">*</span> d_mu, <span class="co"># yearly expected demand</span></span>
<span id="cb24-1004"><a href="#cb24-1004" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.50</span></span>
<span id="cb24-1005"><a href="#cb24-1005" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-1006"><a href="#cb24-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1007"><a href="#cb24-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1008"><a href="#cb24-1008" aria-hidden="true" tabindex="-1"></a><span class="co"># Review period (years -&gt; days)</span></span>
<span id="cb24-1009"><a href="#cb24-1009" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="dv">2</span> <span class="sc">*</span> params2<span class="sc">$</span>k) <span class="sc">/</span> (params2<span class="sc">$</span>h <span class="sc">*</span> params2<span class="sc">$</span>d_yearly))      <span class="co"># years between orders</span></span>
<span id="cb24-1010"><a href="#cb24-1010" aria-hidden="true" tabindex="-1"></a>r_period <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">round</span>(<span class="dv">365</span> <span class="sc">*</span> R))                            <span class="co"># days between reviews (&gt;=1)</span></span>
<span id="cb24-1011"><a href="#cb24-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1012"><a href="#cb24-1012" aria-hidden="true" tabindex="-1"></a><span class="co"># Safety stock and S</span></span>
<span id="cb24-1013"><a href="#cb24-1013" aria-hidden="true" tabindex="-1"></a>z_alpha <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(params2<span class="sc">$</span>alpha)</span>
<span id="cb24-1014"><a href="#cb24-1014" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> z_alpha <span class="sc">*</span> <span class="fu">sqrt</span>((l_mu <span class="sc">+</span> r_period) <span class="sc">*</span> d_std<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> l_std<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> d_mu<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb24-1015"><a href="#cb24-1015" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> (l_mu <span class="sc">+</span> r_period) <span class="sc">*</span> d_mu <span class="sc">+</span> ss</span>
<span id="cb24-1016"><a href="#cb24-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1017"><a href="#cb24-1017" aria-hidden="true" tabindex="-1"></a>n_days <span class="ot">&lt;-</span> t</span>
<span id="cb24-1018"><a href="#cb24-1018" aria-hidden="true" tabindex="-1"></a>max_lead_time <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(l_mu <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> l_std) <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb24-1019"><a href="#cb24-1019" aria-hidden="true" tabindex="-1"></a><span class="co"># in_transit rows are calendar days; we only store arrival quantities</span></span>
<span id="cb24-1020"><a href="#cb24-1020" aria-hidden="true" tabindex="-1"></a>in_transit <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> n_days <span class="sc">+</span> max_lead_time, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb24-1021"><a href="#cb24-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(in_transit) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"quantity"</span>)</span>
<span id="cb24-1022"><a href="#cb24-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1023"><a href="#cb24-1023" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre-sample all daily demand</span></span>
<span id="cb24-1024"><a href="#cb24-1024" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">round</span>(<span class="fu">rnorm</span>(n_days, d_mu, d_std)))</span>
<span id="cb24-1025"><a href="#cb24-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1026"><a href="#cb24-1026" aria-hidden="true" tabindex="-1"></a><span class="co"># Outputs</span></span>
<span id="cb24-1027"><a href="#cb24-1027" aria-hidden="true" tabindex="-1"></a>on_hand <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb24-1028"><a href="#cb24-1028" aria-hidden="true" tabindex="-1"></a>backorders <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb24-1029"><a href="#cb24-1029" aria-hidden="true" tabindex="-1"></a>inventory_position <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)  <span class="co"># on-hand + on-order - backorders</span></span>
<span id="cb24-1030"><a href="#cb24-1030" aria-hidden="true" tabindex="-1"></a>orders <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb24-1031"><a href="#cb24-1031" aria-hidden="true" tabindex="-1"></a>lead_times <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_days)</span>
<span id="cb24-1032"><a href="#cb24-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1033"><a href="#cb24-1033" aria-hidden="true" tabindex="-1"></a><span class="co"># initial state (before day 1)</span></span>
<span id="cb24-1034"><a href="#cb24-1034" aria-hidden="true" tabindex="-1"></a>on_hand_prev <span class="ot">&lt;-</span> S      <span class="co"># starting full to S</span></span>
<span id="cb24-1035"><a href="#cb24-1035" aria-hidden="true" tabindex="-1"></a>backorders_prev <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-1036"><a href="#cb24-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1037"><a href="#cb24-1037" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (day <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_days) {</span>
<span id="cb24-1038"><a href="#cb24-1038" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrivals this morning</span></span>
<span id="cb24-1039"><a href="#cb24-1039" aria-hidden="true" tabindex="-1"></a>  arrival_qty <span class="ot">&lt;-</span> in_transit[day, <span class="st">"quantity"</span>]</span>
<span id="cb24-1040"><a href="#cb24-1040" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-1041"><a href="#cb24-1041" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) allocate arrivals to existing backorders first</span></span>
<span id="cb24-1042"><a href="#cb24-1042" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (arrival_qty <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> backorders_prev <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb24-1043"><a href="#cb24-1043" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (arrival_qty <span class="sc">&gt;=</span> backorders_prev) {</span>
<span id="cb24-1044"><a href="#cb24-1044" aria-hidden="true" tabindex="-1"></a>      arrival_remaining <span class="ot">&lt;-</span> arrival_qty <span class="sc">-</span> backorders_prev</span>
<span id="cb24-1045"><a href="#cb24-1045" aria-hidden="true" tabindex="-1"></a>      backorders_cur <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-1046"><a href="#cb24-1046" aria-hidden="true" tabindex="-1"></a>      on_hand_cur <span class="ot">&lt;-</span> on_hand_prev <span class="sc">+</span> arrival_remaining</span>
<span id="cb24-1047"><a href="#cb24-1047" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb24-1048"><a href="#cb24-1048" aria-hidden="true" tabindex="-1"></a>      <span class="co"># arrival not enough to clear backorders</span></span>
<span id="cb24-1049"><a href="#cb24-1049" aria-hidden="true" tabindex="-1"></a>      backorders_cur <span class="ot">&lt;-</span> backorders_prev <span class="sc">-</span> arrival_qty</span>
<span id="cb24-1050"><a href="#cb24-1050" aria-hidden="true" tabindex="-1"></a>      on_hand_cur <span class="ot">&lt;-</span> on_hand_prev  <span class="co"># usually 0 when backorders exist</span></span>
<span id="cb24-1051"><a href="#cb24-1051" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-1052"><a href="#cb24-1052" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-1053"><a href="#cb24-1053" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no outstanding backorders or no arrivals</span></span>
<span id="cb24-1054"><a href="#cb24-1054" aria-hidden="true" tabindex="-1"></a>    backorders_cur <span class="ot">&lt;-</span> backorders_prev</span>
<span id="cb24-1055"><a href="#cb24-1055" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> on_hand_prev <span class="sc">+</span> arrival_qty</span>
<span id="cb24-1056"><a href="#cb24-1056" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-1057"><a href="#cb24-1057" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-1058"><a href="#cb24-1058" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) satisfy today's demand (d[day])</span></span>
<span id="cb24-1059"><a href="#cb24-1059" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (on_hand_cur <span class="sc">&gt;=</span> d[day]) {</span>
<span id="cb24-1060"><a href="#cb24-1060" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> on_hand_cur <span class="sc">-</span> d[day]</span>
<span id="cb24-1061"><a href="#cb24-1061" aria-hidden="true" tabindex="-1"></a>    <span class="co"># backorders_cur remains whatever it is (possibly 0)</span></span>
<span id="cb24-1062"><a href="#cb24-1062" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-1063"><a href="#cb24-1063" aria-hidden="true" tabindex="-1"></a>    <span class="co"># demand exceeds on-hand -&gt; create backorders</span></span>
<span id="cb24-1064"><a href="#cb24-1064" aria-hidden="true" tabindex="-1"></a>    backorders_cur <span class="ot">&lt;-</span> backorders_cur <span class="sc">+</span> (d[day] <span class="sc">-</span> on_hand_cur)</span>
<span id="cb24-1065"><a href="#cb24-1065" aria-hidden="true" tabindex="-1"></a>    on_hand_cur <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-1066"><a href="#cb24-1066" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-1067"><a href="#cb24-1067" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-1068"><a href="#cb24-1068" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) compute on-order (future arrivals) and inventory position</span></span>
<span id="cb24-1069"><a href="#cb24-1069" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (day <span class="sc">&lt;</span> <span class="fu">nrow</span>(in_transit)) {</span>
<span id="cb24-1070"><a href="#cb24-1070" aria-hidden="true" tabindex="-1"></a>    total_in_transit <span class="ot">&lt;-</span> <span class="fu">sum</span>(in_transit[(day <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(in_transit), <span class="st">"quantity"</span>])</span>
<span id="cb24-1071"><a href="#cb24-1071" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-1072"><a href="#cb24-1072" aria-hidden="true" tabindex="-1"></a>    total_in_transit <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-1073"><a href="#cb24-1073" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-1074"><a href="#cb24-1074" aria-hidden="true" tabindex="-1"></a>  inv_pos <span class="ot">&lt;-</span> on_hand_cur <span class="sc">+</span> total_in_transit <span class="sc">-</span> backorders_cur</span>
<span id="cb24-1075"><a href="#cb24-1075" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-1076"><a href="#cb24-1076" aria-hidden="true" tabindex="-1"></a>  <span class="co"># save</span></span>
<span id="cb24-1077"><a href="#cb24-1077" aria-hidden="true" tabindex="-1"></a>  on_hand[day] <span class="ot">&lt;-</span> on_hand_cur</span>
<span id="cb24-1078"><a href="#cb24-1078" aria-hidden="true" tabindex="-1"></a>  backorders[day] <span class="ot">&lt;-</span> backorders_cur</span>
<span id="cb24-1079"><a href="#cb24-1079" aria-hidden="true" tabindex="-1"></a>  inventory_position[day] <span class="ot">&lt;-</span> inv_pos</span>
<span id="cb24-1080"><a href="#cb24-1080" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-1081"><a href="#cb24-1081" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4) periodic review: order up to S (inventory position used)</span></span>
<span id="cb24-1082"><a href="#cb24-1082" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (day <span class="sc">%%</span> r_period <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb24-1083"><a href="#cb24-1083" aria-hidden="true" tabindex="-1"></a>    l_time <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>, l_mu, l_std)))</span>
<span id="cb24-1084"><a href="#cb24-1084" aria-hidden="true" tabindex="-1"></a>    order_qty <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, S <span class="sc">-</span> inv_pos)</span>
<span id="cb24-1085"><a href="#cb24-1085" aria-hidden="true" tabindex="-1"></a>    arrival_day <span class="ot">&lt;-</span> day <span class="sc">+</span> l_time</span>
<span id="cb24-1086"><a href="#cb24-1086" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (arrival_day <span class="sc">&lt;=</span> <span class="fu">nrow</span>(in_transit)) {</span>
<span id="cb24-1087"><a href="#cb24-1087" aria-hidden="true" tabindex="-1"></a>      in_transit[arrival_day, <span class="st">"quantity"</span>] <span class="ot">&lt;-</span> in_transit[arrival_day, <span class="st">"quantity"</span>] <span class="sc">+</span> order_qty</span>
<span id="cb24-1088"><a href="#cb24-1088" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb24-1089"><a href="#cb24-1089" aria-hidden="true" tabindex="-1"></a>      <span class="co"># arrival beyond simulation time period/horizon — ignore or extend in_transit</span></span>
<span id="cb24-1090"><a href="#cb24-1090" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Here we ignore</span></span>
<span id="cb24-1091"><a href="#cb24-1091" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-1092"><a href="#cb24-1092" aria-hidden="true" tabindex="-1"></a>    orders[day] <span class="ot">&lt;-</span> order_qty</span>
<span id="cb24-1093"><a href="#cb24-1093" aria-hidden="true" tabindex="-1"></a>    lead_times[day] <span class="ot">&lt;-</span> l_time</span>
<span id="cb24-1094"><a href="#cb24-1094" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1095"><a href="#cb24-1095" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cat(sprintf("Day %3d REVIEW: inv_pos = %.1f, order = %.0f, lead = %d (arrive day %d)\n",</span></span>
<span id="cb24-1096"><a href="#cb24-1096" aria-hidden="true" tabindex="-1"></a>    <span class="co">#            day, inv_pos, order_qty, l_time, arrival_day))</span></span>
<span id="cb24-1097"><a href="#cb24-1097" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-1098"><a href="#cb24-1098" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-1099"><a href="#cb24-1099" aria-hidden="true" tabindex="-1"></a>  <span class="co"># update previous for next day</span></span>
<span id="cb24-1100"><a href="#cb24-1100" aria-hidden="true" tabindex="-1"></a>  on_hand_prev <span class="ot">&lt;-</span> on_hand_cur</span>
<span id="cb24-1101"><a href="#cb24-1101" aria-hidden="true" tabindex="-1"></a>  backorders_prev <span class="ot">&lt;-</span> backorders_cur</span>
<span id="cb24-1102"><a href="#cb24-1102" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-1103"><a href="#cb24-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1104"><a href="#cb24-1104" aria-hidden="true" tabindex="-1"></a>results_2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb24-1105"><a href="#cb24-1105" aria-hidden="true" tabindex="-1"></a>  <span class="at">days =</span> <span class="dv">1</span><span class="sc">:</span>n_days,</span>
<span id="cb24-1106"><a href="#cb24-1106" aria-hidden="true" tabindex="-1"></a>  <span class="at">on_hand =</span> on_hand,</span>
<span id="cb24-1107"><a href="#cb24-1107" aria-hidden="true" tabindex="-1"></a>  <span class="at">backorders =</span> backorders,</span>
<span id="cb24-1108"><a href="#cb24-1108" aria-hidden="true" tabindex="-1"></a>  <span class="at">inventory_position =</span> inventory_position,</span>
<span id="cb24-1109"><a href="#cb24-1109" aria-hidden="true" tabindex="-1"></a>  <span class="at">demand =</span> d,</span>
<span id="cb24-1110"><a href="#cb24-1110" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_qty =</span> orders</span>
<span id="cb24-1111"><a href="#cb24-1111" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-1112"><a href="#cb24-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1113"><a href="#cb24-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1114"><a href="#cb24-1114" aria-hidden="true" tabindex="-1"></a>results_2<span class="sc">|&gt;</span> </span>
<span id="cb24-1115"><a href="#cb24-1115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days)) <span class="sc">+</span></span>
<span id="cb24-1116"><a href="#cb24-1116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> on_hand), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-1117"><a href="#cb24-1117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> backorders), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-1118"><a href="#cb24-1118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-1119"><a href="#cb24-1119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-1120"><a href="#cb24-1120" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Stochastic simulation of a (R, S) policy"</span>,</span>
<span id="cb24-1121"><a href="#cb24-1121" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"With alpha = 0.50"</span> </span>
<span id="cb24-1122"><a href="#cb24-1122" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb24-1123"><a href="#cb24-1123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="dv">0</span>, n_days, r_period), </span>
<span id="cb24-1124"><a href="#cb24-1124" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb24-1125"><a href="#cb24-1125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, n_days, r_period), <span class="at">y =</span> s <span class="sc">+</span> <span class="dv">1</span>, </span>
<span id="cb24-1126"><a href="#cb24-1126" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Reorder"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>)</span>
<span id="cb24-1127"><a href="#cb24-1127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-1128"><a href="#cb24-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1129"><a href="#cb24-1129" aria-hidden="true" tabindex="-1"></a>Wow, compare @fig-plot6 with @fig-plot7. Changing $\alpha$ &amp; $\sigma^{2}_{l}$ really makes the inventory more insecure. I suggest changing the hyperparameters of demand and lead-time, you will see big changes in the behavior of the simulation; at the same time change $\alpha$, you will notice that while increasing the variability of the model, keeping an $\alpha$ above 90% will really keep your inventory mostly safe.</span>
<span id="cb24-1130"><a href="#cb24-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1131"><a href="#cb24-1131" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sad reality</span></span>
<span id="cb24-1132"><a href="#cb24-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1133"><a href="#cb24-1133" aria-hidden="true" tabindex="-1"></a>There's something sad around this last simulation. It also has assumptions that hurts its accuracy. Assumptions:</span>
<span id="cb24-1134"><a href="#cb24-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1135"><a href="#cb24-1135" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Normality. Demand nor lead-time aren't normal. They are discrete variables.</span>
<span id="cb24-1136"><a href="#cb24-1136" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Independence. We are assuming that demand and lead-time are independent of each other, this can be untrue, we have to check their correlation.</span>
<span id="cb24-1137"><a href="#cb24-1137" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Stationary. Demand has high autocorrelation, therefore it does not behave like in @fig-plot8.</span>
<span id="cb24-1138"><a href="#cb24-1138" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Different orders can cross each other.</span>
<span id="cb24-1139"><a href="#cb24-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1142"><a href="#cb24-1142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-1143"><a href="#cb24-1143" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot8</span></span>
<span id="cb24-1144"><a href="#cb24-1144" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "This kind of behavior isn't real. There is high autocorrelation. "</span></span>
<span id="cb24-1145"><a href="#cb24-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1146"><a href="#cb24-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1147"><a href="#cb24-1147" aria-hidden="true" tabindex="-1"></a>plot8 <span class="ot">&lt;-</span> results <span class="sc">|&gt;</span> </span>
<span id="cb24-1148"><a href="#cb24-1148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days, <span class="at">y =</span> demand)) <span class="sc">+</span></span>
<span id="cb24-1149"><a href="#cb24-1149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"firebrick1"</span>) <span class="sc">+</span></span>
<span id="cb24-1150"><a href="#cb24-1150" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-1151"><a href="#cb24-1151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-1152"><a href="#cb24-1152" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Demand"</span>,</span>
<span id="cb24-1153"><a href="#cb24-1153" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Stationarity demand is behaving"</span> </span>
<span id="cb24-1154"><a href="#cb24-1154" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-1155"><a href="#cb24-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1156"><a href="#cb24-1156" aria-hidden="true" tabindex="-1"></a>plot8</span>
<span id="cb24-1157"><a href="#cb24-1157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-1158"><a href="#cb24-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1159"><a href="#cb24-1159" aria-hidden="true" tabindex="-1"></a>All of these makes the stochastic model with room for improvement --- but not today.</span>
<span id="cb24-1160"><a href="#cb24-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1161"><a href="#cb24-1161" aria-hidden="true" tabindex="-1"></a><span class="fu"># Reflection</span></span>
<span id="cb24-1162"><a href="#cb24-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1163"><a href="#cb24-1163" aria-hidden="true" tabindex="-1"></a>Making an inventory simulation isn't as easy as someone would had think. Complex supply chains demand us making adjustments to old models, like EOQ model where @eq-qstar was derived. This seems to be part of an ever changing world that after the Renascence the rate of change has increased dramatically. However, this old simplistic models do help us makes sense the phenomena we are trying to understand; and this can be applied to all models, not even mathematical ones, at the end we live in a world we don't understand.</span>
<span id="cb24-1164"><a href="#cb24-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1165"><a href="#cb24-1165" aria-hidden="true" tabindex="-1"></a><span class="fu">## P.D.</span></span>
<span id="cb24-1166"><a href="#cb24-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1167"><a href="#cb24-1167" aria-hidden="true" tabindex="-1"></a>I thought this article would take me 2 days to finish. It took me 5. I am quite exhausted. I just love doing some math, and trying to make sense of the world and do crazy stuff. Anyone who came all the way to here, I hope you liked it; I know math can be hard, but it really is useful, and congrats if you made the effort, go right now to celebrate with your love ones. Cheers.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Made with Quarto</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>